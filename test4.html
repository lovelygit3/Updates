<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Hallows Eve Dashboard</title>

<!-- updater fetched from jsDelivr; runs before any UI code -->
<script type="module">
  import { checkUpdate } from 'https://cdn.jsdelivr.net/gh/lovelygit3/Updates@latest/updater8.js?b=2025-11-02-b';

  // Assign to global so manual triggers can call it
  window.__dashUpdate = () => checkUpdate();

  // Run auto check once on load
  checkUpdate();
</script>

<style>
:root {
  --bg-img: url("https://picsum.photos/id/1011/1600/900");
  --bg-col: #000;
  --text: #fff;
  --accent: #7cffb2;
  --muted: rgba(255,255,255,.65);
  --r: 12px;
  --w: 150px;
  --h: 225px;
  font-family: Inter,system-ui,sans-serif;
}
html,body {
  height: 100%;
  margin: 0;
  color: var(--text);
}
body {
  background: var(--bg-col) var(--bg-img) center/cover no-repeat fixed;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}
#buildTag {
  position: fixed; top: 6px; left: 6px;
  font: 12px/14px monospace;
  background: #000a; padding: 2px 6px; border-radius: 4px;
  z-index: 1200; color: #fff;
}
#splash {
  position: fixed; inset: 0;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  background: #000; z-index: 1000;
}
#splash h1 { font-size: 3rem; margin: 0; letter-spacing: .15rem; }
.loader {
  width: 240px; height: 6px; background: #333; border-radius: 3px; margin-top: 24px; overflow: hidden;
}
.loader::before {
  content: ""; display: block; width: 40%; height: 100%; background: var(--accent);
  animation: load 1.2s linear infinite;
}
@keyframes load {
  0% { transform: translateX(-100%); }
  100% { transform: translateX(300%); }
}
@keyframes splashOut {
  to { opacity: 0; visibility: hidden; }
}
#app {
  flex: 1; display: flex; flex-direction: column; opacity: 0; animation: appIn .6s 1.4s forwards;
}
@keyframes appIn {
  to { opacity: 1; }
}
header {
  display: flex; justify-content: space-between; align-items: center; padding: 10px 24px;
  background: rgba(0, 0, 0, .45); backdrop-filter: blur(6px);
}
#brand { margin: 0; font-size: 1.55rem; letter-spacing: .12rem; }
.nav { display: flex; gap: 10px; }
.btn {
  background: transparent; border: 2px solid var(--accent); color: var(--text);
  padding: 6px 14px; border-radius: 8px; font-weight: 600; cursor: pointer;
}
.btn:hover { background: var(--accent); color: #000; }
.page { display: none; flex: 1; overflow: auto; padding: 26px; }
.page.active { display: flex; flex-direction: column; animation: pgIn .4s; }
@keyframes pgIn {
  from { opacity: 0; transform: translateY(24px); }
  to { opacity: 1; }
}
#home { display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100%; }
#home h2 { font-size: 2.4rem; margin: 0 0 10px; }
.upBox {
  background: rgba(255,255,255,.07); padding: 22px 26px; border-radius: var(--r); max-width: 540px;
}
.list {
  display: flex; flex-direction: column; gap: 20px; max-width: 1200px; margin: auto;
}
.card {
  display: flex; gap: 16px; padding: 14px; background: rgba(255,255,255,.07); border-radius: var(--r);
  align-items: center; box-shadow: 0 6px 18px #000a;
}
.cover { width: var(--w); height: var(--h); border-radius: var(--r); overflow: hidden; cursor: pointer; }
.cover img { width: 100%; height: 100%; object-fit: cover; transition: transform .35s; }
.cover:hover img { transform: scale(1.07); }
.title { font-size: 1.05rem; font-weight: 700; }
.descr { font-size: .9rem; color: var(--muted); }
.launch {
  margin-left: auto; background: var(--accent); color: #000; border: none; border-radius: 8px;
  padding: 8px 16px; font-weight: 600; cursor: pointer;
}
/* Added styles for search inputs: only on pages with search */
#searchMovies, #searchGames {
  width: 100%; padding: 6px; border-radius: 4px; border: 1px solid #444; background: #222; color: #fff; font-size: .85rem; margin-bottom: 10px;
}
/* Bookmark star icon: ☆ (default), ★ (bookmarked) with color */
.bookmark-btn {
  background: transparent; border: none; font-size: 1.5em; margin-left: 8px; cursor: pointer; color: inherit;
}
/* overlay styles omitted for brevity, same as original */
#overlay { position: fixed; inset: 0; background: rgba(0,0,0,.9); display: none; align-items: center; justify-content: center; z-index:900;}
#playerBox { width: 90%; height: 85%; background: #000; border-radius: var(--r); overflow: hidden; display: flex; flex-direction: column; }
#player { flex: 1; border: none; background: #000; }
.ovBtns { position: fixed; top: 18px; right: 24px; display: flex; gap: 10px; z-index: 1001; }
.ovBtn { background: rgba(255,255,255,.15); border: none; color: #fff; border-radius: 6px; padding: 8px 12px; font-size: 18px; cursor: pointer; }
#settings { position: fixed; top: 76px; right: 24px; background: #111; padding: 14px; border: 1px solid #333; border-radius: var(--r); display: none; z-index:950; width: 260px;}
#settings label { font-size: .83rem; color: var(--muted); }
#settings input { width: 100%; padding: 6px; border-radius: 4px; border: 1px solid #444; background: #222; color: #fff; margin-bottom: 10px; font-size: .85rem; }
#settings .btn { width: 100%; padding: 6px; }
.toast { position: fixed; bottom: 22px; left: 50%; transform: translateX(-50%); background: #222; color: #fff; padding: 12px 18px; border-radius: 8px; box-shadow: 0 6px 18px #000a; z-index: 1100; display: flex; gap: 10px; align-items: center; opacity: 0; animation: toastIn .3s forwards; }
@keyframes toastIn { to { opacity: 1; } }
.toast button { background: var(--accent); border: none; border-radius: 6px; padding: 4px 8px; font-weight: 600; cursor: pointer; font-size: .8rem; }
</style>
</head>
<body>

<div id="buildTag">build <span id="buildNo"></span></div>

<!-- splash -->
<div id="splash"><h1>HALLOWS EVE</h1><div class="loader"></div></div>

<!-- main -->
<div id="app">
  <header>
    <h1 id="brand">HALLOWS EVE</h1>
    <div class="nav">
      <button class="btn navBtn" data-page="home">Home</button>
      <button class="btn navBtn" data-page="movies">Movies</button>
      <button class="btn navBtn" data-page="games">Games</button>
      <button class="btn" id="gear">⚙️</button>
    </div>
  </header>

  <section id="home" class="page active" style="display:flex; flex-direction:column; justify-content:center; align-items:center; height:100%;">
    <div id="homePage"><h2>Welcome</h2>
      <div class="upBox"><p>Self-updating dashboard • FNF playable</p></div>
    </div>
  </section>

  <!-- MOVIES PAGE with search and bookmark -->
  <section id="movies" class="page" style="display:none;">
    <input type="text" id="searchMovies" placeholder="Search movies..." />
    <div class="list" id="movieList"></div>
  </section>

  <!-- GAMES PAGE with search and bookmark -->
  <section id="games" class="page" style="display:none;">
    <input type="text" id="searchGames" placeholder="Search games..." />
    <div class="list" id="gameList"></div>
  </section>
</div>

<!-- overlay -->
<div id="overlay" style="display:none;">
  <div class="ovBtns"><button class="ovBtn" id="ovFull">⛶</button>
                       <button class="ovBtn" id="ovClose">✖</button></div>
  <div id="playerBox"><iframe id="player" allowfullscreen></iframe></div>
</div>

<!-- settings -->
<div id="settings" style="display:none;">
  <label>Background image URL</label><input id="bgInput" type="text" />
  <label>Text colour</label><input id="txtColor" type="color" />
  <label>Accent / button colour</label><input id="accColor" type="color" />
  <label><input type="checkbox" id="autoUpd" /> Auto-update dashboard</label>
  <button class="btn" id="chkUpd">Check update now</button>
  <button class="btn" id="saveTheme">Save &amp; apply</button>
</div>

<!-- Your existing script -->
<script>
if (sessionStorage.updatedTo && sessionStorage.updatedTo !== '2025-11-02-b') {
  sessionStorage.removeItem('updatedTo');
  throw 'old build';
}

(() => {
  const BUILD='2025-11-02-b';
  document.getElementById('buildNo').textContent=BUILD;

  const q=s=>document.querySelector(s), qa=s=>[...document.querySelectorAll(s)];
  function toast(msg,btns=[]){
    const t=Object.assign(document.createElement('div'),{className:'toast',textContent:msg});
    btns.forEach(([txt,fn])=>{const b=document.createElement('button');b.textContent=txt; b.onclick=()=>{fn();t.remove();}; t.appendChild(b);});
    document.body.appendChild(t);
    if(!btns.length){setTimeout(()=>t.style.opacity=0,4000);setTimeout(()=>t.remove(),4700);}
  }

  /* splash fade out with event listener for animation end */
  const splash = document.getElementById('splash');
  splash.style.animation='splashOut 0.6s forwards';
  splash.addEventListener('animationend', () => {
    splash.style.display='none';
    document.getElementById('app').style.display='flex';
  });

  /* hide main initially, then fade in (optional) */
  document.getElementById('app').style.display='none';

  /* theme / settings */
  function applyTheme(o){
    if(o.bg)  document.documentElement.style.setProperty('--bg-img',`url(${o.bg})`);
    if(o.text)document.documentElement.style.setProperty('--text',o.text);
    if(o.acc) document.documentElement.style.setProperty('--accent',o.acc);
  }
  const savedTheme=JSON.parse(localStorage.getItem('hallowsTheme')||'{}'); applyTheme(savedTheme);
  if(savedTheme.bg)q('#bgInput').value=savedTheme.bg;
  if(savedTheme.text)q('#txtColor').value=savedTheme.text;
  if(savedTheme.acc)q('#accColor').value=savedTheme.acc;

  const settingsBox=q('#settings');
  q('#gear').onclick=()=>settingsBox.style.display=settingsBox.style.display?'':'block';
  q('#saveTheme').onclick=()=>{
    const o={bg:q('#bgInput').value.trim(),text:q('#txtColor').value,acc:q('#accColor').value};
    localStorage.setItem('hallowsTheme',JSON.stringify(o));
    if(o.bg){ document.documentElement.style.setProperty('--bg-img',`url(${o.bg})`); document.body.style.backgroundImage=`url(${o.bg})`; }
    if(o.text){ document.documentElement.style.setProperty('--text',o.text); }
    if(o.acc){ document.documentElement.style.setProperty('--accent',o.acc); }
    document.querySelector('header').style.background= 'rgba(0,0,0,.45)';
    document.querySelector('header').style.color= 'var(--text)';
    document.querySelectorAll('.nav button').forEach(b=>{ b.style.color= getComputedStyle(document.documentElement).getPropertyValue('--text'); });
    document.getElementById('settings').style.display='none';
  };

  q('#autoUpd').checked  = JSON.parse(localStorage.getItem('autoUpdDash')||'false');
  q('#autoUpd').onchange = e=>localStorage.setItem('autoUpdDash',e.target.checked);
  q('#chkUpd').onclick=()=>window.__dashUpdate(true);

  /* navigation */
  qa('.navBtn').forEach(b=>{
    b.onclick=()=>{
      qa('.page').forEach(p=>p.classList.remove('active'));
      q('#'+b.dataset.page).classList.add('active');
    };
  });

  /* movies & games data (your original arrays) */
  const movies=[
    {title:'Sample Movie',cover:'https://picsum.photos/200/300?1',descr:'YT demo',url:'https://www.youtube.com/embed/dQw4w9WgXcQ'},
    {title:'Big Buck Bunny',cover:'https://peach.blender.org/wp-content/uploads/bbb-splash.png',descr:'Blender Open Movie',url:'https://www.youtube.com/embed/YE7VzlLtp-4'},
    {title:'Sintel',cover:'https://download.blender.org/durian/trailer/sintel_trailer-480p.png',descr:'Blender short',url:'https://www.youtube.com/embed/eRsGyueVLvQ'}
  ];
  const games=[
    {title:"Friday Night Funkin'",cover:'https://picsum.photos/200/300?3',descr:'jsDelivr',url:'https://cdn.jsdelivr.net/gh/genizy/fridayfunk/index.html'},
    {title:'Jelly Mario',cover:'https://upload.wikimedia.org/wikipedia/commons/7/7d/2048_logo.svg',descr:'Classic puzzle',url:'https://gamesgo.net/game/friday-night-funkin-vs-qt-mod'},
    {title:'Celeste Classic',cover:'https://raw.githubusercontent.com/mmalet/celeste-classic/master/assets/cover.png',descr:'Pico-8',url:'https://www.lexaloffle.com/bbs/?pid=2397#p'},
    {title:'Test Game',cover:'https://picsum.photos/200/300?random=999',descr:'Test description',url:'https://example.com/testgame.html'}
  ];

  /* create cards for movies & games with bookmark star (☆ or ★) */
  function createCard(item){
    const div=document.createElement('div');
    div.className='card';
    div.dataset.url=item.url;
    div.innerHTML= `
      <div class="cover"><img src="${item.cover}"></div>
      <div class="meta"><div class="title">${item.title}</div><div class="descr">${item.descr}</div></div>
      <button class="launch">Launch</button>
      <button class="bookmark-btn">☆</button>`;
    // set initial star
    const bm=JSON.parse(localStorage.getItem('bookmarkedMovies')||'[]');
    const starBtn=div.querySelector('.bookmark-btn');
    if(bm.includes(item.title)){
      starBtn.textContent='★'; starBtn.style.color='gold';
    } else {
      starBtn.textContent='☆'; starBtn.style.color='';
    }
    // toggle bookmark on double click
    starBtn.ondblclick=()=>{
      let bm=JSON.parse(localStorage.getItem('bookmarkedMovies')||'[]');
      const t=item.title;
      if(bm.includes(t)){
        bm=bm.filter(t2=>t2!==t);
        starBtn.textContent='☆'; starBtn.style.color='';
      } else {
        bm.push(t);
        starBtn.textContent='★'; starBtn.style.color='gold';
      }
      localStorage.setItem('bookmarkedMovies', JSON.stringify(bm));
      updateBookmarks('movie');
    };
    return div;
  }

  // fill lists
  const fill=(sel,arr)=>{const box=document.querySelector(sel); box.innerHTML=''; arr.forEach(o=>box.appendChild(createCard(o)));};
  fill('#movieList',movies);
  fill('#gameList',games);

  // update bookmarks (move to top)
  function updateBookmarks(type='movie'){
    const key=type==='movie'?'bookmarkedMovies':'bookmarkedGames';
    let bm=JSON.parse(localStorage.getItem(key))||[];
    const list=type==='movie' ? movies.slice() : games.slice();
    list.sort((a,b)=> bm.includes(a.title) ? -1 : bm.includes(b.title) ? 1 : 0);
    fill(type==='movie' ? '#movieList' : '#gameList', list);
  }
  // initial order
  updateBookmarks('movie');
  updateBookmarks('game');

  // Search filtering
  document.getElementById('searchMovies').addEventListener('input', e => {
    const q=e.target.value.toLowerCase();
    document.querySelectorAll('#movieList .card').forEach(c => {
      const t=c.querySelector('.title').textContent.toLowerCase();
      c.style.display= t.includes(q) ? '' : 'none';
    });
  });
  document.getElementById('searchGames').addEventListener('input', e => {
    const q=e.target.value.toLowerCase();
    document.querySelectorAll('#gameList .card').forEach(c => {
      const t=c.querySelector('.title').textContent.toLowerCase();
      c.style.display= t.includes(q) ? '' : 'none';
    });
  });
})();
</script>
</body>
</html>
