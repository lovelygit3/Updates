<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="app-version" content="1.8.0">
  <title>Media Hub</title>

  <link id="dynamic-favicon" rel="icon" href="">


  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />


  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --rosewater: #F5E0DC;
      --flamingo: #F2CDCD;
      --pink: #F5C2E7;
      --mauve: #CBA6F7;
      --red: #F38BA8;
      --maroon: #EBA0AC;
      --peach: #FAB387;
      --yellow: #F9E2AF;
      --green: #A6E3A1;
      --teal: #94E2D5;
      --sky: #89DCEB;
      --sapphire: #74C7EC;
      --blue: #89B4FA;
      --lavender: #B4BEFE;
      --text: #CDD6F4;
      --subtext: #A6ADC8;
      --surface1: #45475A;
      --surface0: #313244;
      --base: #1E1E2E;
      --mantle: #181825;

      --bg-color: var(--base);
      --bg-image: none;
      --text-color: var(--text);
      --accent-color: var(--mauve);
      --button-color: var(--blue);
      --effect-color: rgba(203,166,247,0.15);
      --nav-bg: rgba(24,24,37,0.8);
      --nav-active: var(--accent-color);
      --card-bg: rgba(49,50,68,0.9);
      --shadow-color: rgba(0,0,0,0.15);
      --font-size-base: 16px;
      --performance-mode: 0;
      --viewer-width: 98vw;
      --viewer-height: 98vh;

      --button-border-radius: 6px;
      --layout-grid-gap: 20px;
      --nav-layout: row;
      --button-padding: 10px 16px;
      --button-font-size: 1em;
      --card-border-radius: 8px;
      --extra-shadow: none;
      --topbar-flex-direction: row;
      --topbar-position: sticky;
      --topbar-top: 0;
      --topbar-left: auto;
      --topbar-height: auto;
      --topbar-width: auto;
      --main-margin-left: 0;
      --main-margin-top: 60px;
      --card-hover-lift: 4px;
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Inter', sans-serif;
      color: var(--text-color);
      transition: background-color 300ms ease, color 300ms ease, background-image 300ms ease;
      font-size: var(--font-size-base);
      overflow: hidden;
      overflow-y: auto;
    }

    body.no-scroll {
      overflow: hidden;
    }

    body.performance-mode {
      --shadow-color: transparent;
      transition: none;
    }

    body.page-no-scroll {
      overflow: hidden;
    }


    body {
      --bg-color: radial-gradient(circle at 20% 20%, #2b144d 0%, #120b26 40%, #090610 100%);
      --text-color: #f5f3ff;
      --accent-color: #a78bfa;
      --button-color: #7c3aed;
      --effect-color: rgba(167, 139, 250, 0.2);
      --nav-bg: rgba(12, 9, 24, 0.8);
      --nav-active: #c084fc;
      --card-bg: rgba(22, 16, 38, 0.8);
      --shadow-color: rgba(0, 0, 0, 0.35);
      --button-border-radius: 18px;
      --layout-grid-gap: 22px;
      --nav-layout: row;
      --button-padding: 14px 22px;
      --button-font-size: 1.05em;
      --card-border-radius: 20px;
      --extra-shadow: 0 10px 30px rgba(0, 0, 0, 0.45);

      background-color: #05030a !important;
      background-image: var(--bg-image), var(--bg-color) !important;
      background-size: cover, cover !important;
      background-position: center, center !important;
      background-repeat: no-repeat, no-repeat !important;
      background-attachment: fixed !important;
    }

    .topbar {
      backdrop-filter: blur(15px);
      background: var(--nav-bg);
      border-bottom: none;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 50;
      display: flex;
      align-items: center;
      padding: 10px 20px;
      flex-direction: var(--topbar-flex-direction);
      position: var(--topbar-position);
      top: var(--topbar-top);
      left: var(--topbar-left);
      height: var(--topbar-height);
      width: var(--topbar-width);
      justify-content: space-between;
    }

    .nav {
      display: flex;
      gap: 12px;
      flex-direction: var(--nav-layout);
    }

    .nav button {
      display: flex;
      align-items: center;
      gap: 10px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: linear-gradient(145deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      color: var(--text-color);
      transition: color 0.2s, transform 0.25s ease, background 0.25s ease, box-shadow 0.25s ease;
      border-radius: 16px;
      padding: 10px 16px;
      cursor: pointer;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    }

    .nav button:hover {
      color: var(--accent-color);
      transform: translateY(-2px);
      background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      box-shadow: 0 14px 30px rgba(0,0,0,0.28);
    }

    .nav button.active {
      color: var(--nav-active);
      background: linear-gradient(145deg, rgba(255,255,255,0.18), rgba(255,255,255,0.05));
      border-color: rgba(255, 255, 255, 0.2);
      box-shadow: 0 16px 36px rgba(0,0,0,0.32);
    }

    .nav button i {
      width: 38px;
      height: 38px;
      border-radius: 12px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.35), rgba(255,255,255,0.1));
      color: var(--nav-active);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.2), 0 8px 18px rgba(0,0,0,0.25);
      transition: transform 0.25s ease, box-shadow 0.25s ease, background 0.25s ease;
    }

    .nav button:hover i {
      transform: scale(1.07) rotate(-2deg);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.35), 0 10px 22px rgba(0,0,0,0.3);
    }

    .card,
    .modal-inner,
    .viewer,
    .update-box,
    .list-item,
    .home-hero,
    .home-extra,
    .bookmark-grid,
    .bookmark-item {
      background: var(--card-bg);
      backdrop-filter: blur(15px);
      border: 1px solid rgba(255,255,255,0.15);
      box-shadow: var(--extra-shadow);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover,
    .bookmark-item:hover,
    .list-item:hover {
      transform: translateY(-6px);
      box-shadow: 0 12px 24px rgba(0,0,0,0.4);
    }

    .home-hero {
      padding: 24px;
      border-radius: var(--card-border-radius);
      background: linear-gradient(145deg, var(--card-bg), rgba(60,40,90,0.5));
      display: grid;
      grid-template-columns: 100px 1fr;
      gap: 28px;
      align-items: center;
      animation: fade-in 0.5s ease;
    }

    .home-hero .avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      box-shadow: 0 4px 12px var(--shadow-color);
      overflow: hidden;
    }

    .home-hero .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .section-hero {
      background: linear-gradient(145deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px;
      padding: 18px 20px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 20px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.28);
    }

    .section-hero .eyebrow {
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-size: 11px;
      color: var(--nav-active);
      margin: 0 0 6px 0;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .section-hero .hero-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 8px;
    }

    .stat-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.2);
      font-weight: 600;
    }

    .stat-pill.accent {
      background: color-mix(in oklab, var(--accent-color) 14%, transparent);
      border-color: color-mix(in oklab, var(--accent-color) 40%, transparent);
    }

    .hero-buttons {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .pill-filters {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 12px 0 16px 0;
    }

    .pill {
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.04);
      color: var(--text-color);
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.15s ease, box-shadow 0.2s ease, background 0.2s ease, border-color 0.2s ease;
    }

    .pill:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.18);
    }

    .pill.active {
      background: color-mix(in oklab, var(--accent-color) 22%, transparent);
      border-color: color-mix(in oklab, var(--accent-color) 45%, transparent);
      color: #0b0b12;
    }

    .media-grid {
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    }

    .media-card .thumb::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(180deg, transparent 40%, rgba(0,0,0,0.35) 100%);
      pointer-events: none;
    }

    .media-card .thumb .badge {
      position: absolute;
      top: 10px;
      left: 10px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,0.45);
      color: #fff;
      font-weight: 700;
      font-size: 12px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.12);
    }

    .media-card .info {
      align-items: flex-start;
      padding: 12px 14px;
      gap: 10px;
    }

    .media-card .title {
      font-size: 1.05em;
    }

    .home-panels {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 14px;
      margin: 18px 0 12px 0;
    }

    .home-panel {
      padding: 18px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.12);
      background: linear-gradient(140deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      box-shadow: 0 10px 24px rgba(0,0,0,0.25);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .home-panel .panel-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .home-panel .tag-label {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--nav-active);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .home-panel .stat {
      font-weight: 800;
      font-size: 1.4em;
      color: var(--nav-active);
    }

    .home-panel .panel-actions {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 6px;
    }

    .home-panel.emerald {
      background: linear-gradient(140deg, rgba(148, 226, 213, 0.22), rgba(12, 18, 32, 0.85));
      border-color: rgba(148,226,213,0.35);
    }

    .home-panel.violet {
      background: linear-gradient(140deg, rgba(203,166,247,0.25), rgba(12, 10, 30, 0.86));
      border-color: rgba(203,166,247,0.4);
    }



    body.theme-nordic-dark {
      --bg-color: radial-gradient(circle at 12% 18%, #2e3440 0%, #0c1629 45%, #070a16 100%);
      --text-color: #e8edf6;
      --accent-color: #8fbcbb;
      --button-color: #3b4252;
      --effect-color: rgba(143, 188, 187, 0.28);
      --nav-bg: rgba(10, 17, 30, 0.82);
      --nav-active: #88c0d0;
      --card-bg: rgba(26, 34, 48, 0.78);
      --shadow-color: rgba(4, 10, 22, 0.5);
    }

    body.theme-sweet {
      --bg-color: radial-gradient(circle at 80% 0%, #ffe0f2 0%, #f9c5d1 45%, #f6d7ff 100%);
      --text-color: #512b58;
      --accent-color: #e255a0;
      --button-color: #f190c1;
      --effect-color: rgba(226, 85, 160, 0.22);
      --nav-bg: rgba(255, 240, 248, 0.85);
      --nav-active: #d63384;
      --card-bg: rgba(255, 255, 255, 0.7);
      --shadow-color: rgba(214, 51, 132, 0.18);
    }

    body.theme-chrome-os {
      --bg-color: linear-gradient(135deg, #0f172a 0%, #0b2347 55%, #0f172a 100%);
      --text-color: #eaf1ff;
      --accent-color: #4dabf7;
      --button-color: #1d4ed8;
      --effect-color: rgba(77, 171, 247, 0.25);
      --nav-bg: rgba(5, 15, 35, 0.85);
      --nav-active: #7dd3fc;
      --card-bg: rgba(13, 31, 60, 0.82);
      --shadow-color: rgba(0, 0, 0, 0.45);
    }

    body.theme-dracula {
      --bg-color: radial-gradient(circle at 15% 15%, #3a1d5e 0%, #1b102e 45%, #0c0a1a 100%);
      --text-color: #f8f7ff;
      --accent-color: #c084fc;
      --button-color: #ff6ad5;
      --effect-color: rgba(192, 132, 252, 0.24);
      --nav-bg: rgba(17, 12, 35, 0.86);
      --nav-active: #7ef2d4;
      --card-bg: rgba(34, 23, 64, 0.82);
      --shadow-color: rgba(0, 0, 0, 0.48);
    }

    body.theme-undertale {
      --bg-color: linear-gradient(180deg, #0a0a0a 0%, #1b0f0f 35%, #050505 100%);
      --text-color: #f8f7f1;
      --accent-color: #ff5555;
      --button-color: #ffd166;
      --effect-color: rgba(255, 85, 85, 0.35);
      --nav-bg: rgba(5, 5, 5, 0.9);
      --nav-active: #ff9f1c;
      --card-bg: rgba(17, 10, 10, 0.85);
      --shadow-color: rgba(255, 85, 85, 0.25);
      font-family: 'Press Start 2P', monospace;
      text-shadow: 1px 1px 0 #1e1e1e;
      image-rendering: pixelated;
    }

    body.theme-macos-sonoma-dark {
      --bg-color: linear-gradient(145deg, #0f172a 0%, #0c1f3f 50%, #0f172a 100%);
      --text-color: #f2f4f7;
      --accent-color: #0ea5e9;
      --button-color: #2563eb;
      --effect-color: rgba(14, 165, 233, 0.22);
      --nav-bg: rgba(7, 12, 24, 0.82);
      --nav-active: #38bdf8;
      --card-bg: rgba(12, 18, 32, 0.86);
      --shadow-color: rgba(0,0,0,0.45);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    body.theme-candy {
      --bg-color: radial-gradient(circle at 10% 0%, #ffb8e6 0%, #ff8fb1 35%, #ffa8d1 60%, #ffd3f4 100%);
      --text-color: #3d1c3c;
      --accent-color: #ff5fa2;
      --button-color: #ff9bd1;
      --effect-color: rgba(255, 95, 162, 0.28);
      --nav-bg: rgba(255, 223, 245, 0.9);
      --nav-active: #ff2d95;
      --card-bg: rgba(255, 255, 255, 0.78);
      --shadow-color: rgba(255, 95, 162, 0.2);
    }

    body.theme-fallout {
      --bg-color: radial-gradient(circle at 20% 20%, #062b00 0%, #031a00 50%, #010f00 100%);
      --text-color: #d3f9d8;
      --accent-color: #9ef01a;
      --button-color: #1b4332;
      --effect-color: rgba(158, 240, 26, 0.22);
      --nav-bg: rgba(1, 10, 1, 0.9);
      --nav-active: #ccff33;
      --card-bg: rgba(6, 34, 12, 0.85);
      --shadow-color: rgba(0, 0, 0, 0.55);
      font-family: 'VT323', monospace;
      text-shadow: 0 0 5px #3efc5b;
    }

    body.theme-void {
      --bg-color: radial-gradient(circle at 70% 20%, #0f0f1a 0%, #050507 55%, #000000 100%);
      --text-color: #d1d5db;
      --accent-color: #9a70ff;
      --button-color: #1f1f2e;
      --effect-color: rgba(154, 112, 255, 0.2);
      --nav-bg: rgba(4,4,7,0.9);
      --nav-active: #c084fc;
      --card-bg: rgba(18,18,28,0.86);
      --shadow-color: rgba(0,0,0,0.65);
    }

    body.theme-shadowrealm {
      --bg-color: linear-gradient(160deg, #0c0b1d 0%, #111133 45%, #0a0a1a 100%);
      --text-color: #d7cffc;
      --accent-color: #7c3aed;
      --button-color: #312e81;
      --effect-color: rgba(124, 58, 237, 0.26);
      --nav-bg: rgba(8, 6, 18, 0.9);
      --nav-active: #a78bfa;
      --card-bg: rgba(22, 19, 48, 0.85);
      --shadow-color: rgba(0,0,0,0.6);
      font-family: 'Georgia', serif;
    }

    body.theme-eclipse {
      --bg-color: radial-gradient(circle at 50% 0%, #1a0a00 0%, #0c0f1a 55%, #04060c 100%);
      --text-color: #f0e9d2;
      --accent-color: #ff9e2c;
      --button-color: #b45309;
      --effect-color: rgba(255, 158, 44, 0.25);
      --nav-bg: rgba(8, 8, 12, 0.88);
      --nav-active: #f97316;
      --card-bg: rgba(32, 24, 16, 0.82);
      --shadow-color: rgba(0,0,0,0.7);
    }

    .grid {
      gap: var(--layout-grid-gap, 16px);
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }

    .btn {
      border-radius: var(--button-border-radius, 8px);
      padding: var(--button-padding, 8px 12px);
      font-size: var(--button-font-size, 1em);
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: transform 120ms ease, box-shadow 120ms ease, background-color 200ms ease, color 200ms ease;
    }

    .btn-primary {
      background: var(--button-color);
      color: #0b0b12;
      box-shadow: 0 6px 18px color-mix(in oklab, var(--button-color) 60%, black 40%);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
    }

    .btn-secondary {
      background: transparent;
      border: 1px solid var(--surface1);
      color: var(--text-color);
    }

    .btn-delete {
      background: var(--red);
      color: white;
    }

    .card {
      border-radius: var(--card-border-radius, 12px);
      background: var(--card-bg);
      border: 1px solid var(--surface1);
      overflow: hidden;
      box-shadow: 0 10px 20px var(--shadow-color);
      position: relative;
      animation: card-slide 0.3s ease;
      transition: transform 150ms ease, box-shadow 150ms ease, border-color 200ms ease;
    }

    @keyframes fade-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes card-slide {
      from { transform: translateX(-50px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .card .thumb {
      width: 100%;
      height: 300px;
      background: linear-gradient(135deg,
        color-mix(in oklab, var(--accent-color) 28%, transparent),
        color-mix(in oklab, var(--button-color) 28%, transparent)
      );
      display: grid;
      place-items: center;
      color: var(--text-color);
      position: relative;
      overflow: hidden;
    }

    .card .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .card .info {
      padding: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .small {
      font-size: 12px;
      color: var(--subtext);
    }

    .icon-btn {
      background: rgba(0,0,0,0.12);
      border: 1px solid var(--surface1);
      color: var(--text-color);
      padding: 6px 8px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 200ms ease, border-color 200ms ease, transform 120ms ease;
    }

    .icon-btn:hover {
      background: rgba(203,166,247,0.18);
      transform: translateY(-1px);
    }

    .bookmark-star {
      font-size: 16px;
      cursor: pointer;
      color: transparent;
      -webkit-text-stroke: 1px var(--accent-color);
      transition: color 0.2s;
    }

    .bookmark-star.active {
      color: var(--accent-color);
      -webkit-text-stroke: 0;
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .tag {
      padding: 2px 6px;
      background: var(--surface1);
      border-radius: 4px;
      font-size: 0.8em;
    }

    .overlay {
      position: fixed;
      inset: 0;
      background: color-mix(in oklab, var(--mantle) 75%, black 25%);
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 60;
      transition: opacity 300ms ease;
    }

    .overlay.open {
      display: flex;
      opacity: 1;
      animation: overlay-fade 0.3s ease;
    }

    @keyframes overlay-fade {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .viewer {
      position: relative;
      width: var(--viewer-width);
      height: var(--viewer-height);
      max-width: none;
      border-radius: 12px;
      overflow: hidden;
      background: var(--card-bg);
      border: 1px solid var(--surface1);
      box-shadow: 0 20px 40px var(--shadow-color);
      display: grid;
      grid-template-rows: auto 1fr;
    }

    .viewer-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: rgba(49,50,68,0.5);
      border-bottom: 1px solid var(--surface1);
    }

    .viewer-iframe {
      width: 100%;
      height: 100%;
      background: #0a0a0f;
      border: none;
      display: block;
    }

    .viewer.fs,
    .viewer:fullscreen {
      position: fixed !important;
      inset: 0 !important;
      width: 100% !important;
      height: 100% !important;
      max-width: none !important;
      max-height: none !important;
      border-radius: 0 !important;
      grid-template-rows: 1fr !important;
      background: #000 !important;
    }

    .viewer.fs .viewer-header,
    .viewer:fullscreen .viewer-header {
      display: none !important;
    }

    main {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
      margin-top: var(--main-margin-top);
    }

    section.page {
      display: none;
      opacity: 0;
      transition: opacity 300ms ease-in-out;
      overflow-y: auto;
      max-height: none;
    }

    section.page.active {
      display: block;
      opacity: 1;
      animation: fade-in 0.5s ease;
    }

    .searchbar {
      display: flex;
      gap: 8px;
      align-items: center;
      margin: 8px 0 16px 0;
    }

    .searchbar input {
      flex: 1;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid var(--surface1);
      background: rgba(49,50,68,0.5);
      color: var(--text-color);
      outline: none;
    }

    .user-id {
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      position: relative !important;
      overflow: visible !important;
      z-index: 9999;
    }

    .avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--accent-color), var(--button-color));
      box-shadow: 0 4px 12px var(--shadow-color);
      overflow: hidden;
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .username {
      font-weight: 600;
      letter-spacing: 0.2px;
    }

    .user-id:hover .avatar {
      transform: scale(1.06);
      box-shadow: 0 6px 20px var(--accent-color);
      transition: 0.25s ease;
    }

    .profile-dropdown {
      position: absolute;
      top: 52px;
      left: 0;
      width: 340px;
      padding: 16px 18px;
      border-radius: 18px;
      background: rgba(20, 20, 30, 0.55);
      backdrop-filter: blur(18px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.45);
      display: none;
      flex-direction: column;
      gap: 12px;
      z-index: 99999 !important;
      animation: dropdown-in 0.25s ease forwards;
      max-height: 80vh;
      overflow-y: auto;
    }

    @keyframes dropdown-in {
      from { opacity: 0; transform: translateY(-8px) scale(0.98); }
      to   { opacity: 1; transform: translateY(0) scale(1); }
    }

    .profile-dropdown .avatar {
      width: 54px !important;
      height: 54px !important;
      border-radius: 12px;
      border: 2px solid var(--accent-color);
      box-shadow: 0 4px 12px var(--shadow-color);
    }

    .profile-dropdown .badge {
      font-size: 12px;
      padding: 4px 10px;
      border-radius: 100px;
      background: var(--accent-color);
      color: #000;
      font-weight: 600;
    }

    .profile-dropdown input,
    .profile-dropdown textarea {
      width: 100%;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.15);
      background: rgba(255,255,255,0.06);
      font-size: 14px;
      color: var(--text-color);
      transition: border-color 0.2s, box-shadow 0.2s;
      outline: none;
      margin-top: 4px;
      margin-bottom: 8px;
    }

    .profile-dropdown input:focus,
    .profile-dropdown textarea:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 6px var(--accent-color);
    }

    .profile-actions {
      display: flex;
      gap: 8px;
    }

    .profile-actions .btn-primary {
      background: var(--accent-color);
      color: #000;
      border-radius: 12px;
      font-weight: 700;
      box-shadow: 0 4px 10px rgba(0,0,0,0.4);
    }

    .profile-actions .btn-secondary {
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.2);
    }

    .topbar #clock {
      font-size: 1.2em;
      color: var(--accent-color);
      order: 1;
      flex-grow: 1;
      text-align: center;
    }

    .topbar .user-id { order: 0; }
    .topbar .nav { order: 2; }

    .list {
      display: grid;
      gap: 8px;
    }

    .list-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--surface1);
      background: rgba(49,50,68,0.5);
      animation: list-item-slide 0.3s ease;
      min-height: 80px;
    }

    @keyframes list-item-slide {
      from { transform: translateY(20px); opacity: 0; }
      to   { transform: translateY(0); opacity: 1; }
    }

    .bookmark-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      max-height: 300px;
      overflow-y: auto;
      padding: 8px;
      border: 1px solid var(--surface1);
      border-radius: 8px;
    }

    .bookmark-item {
      padding: 12px;
      border-radius: var(--card-border-radius);
      box-shadow: var(--extra-shadow);
      cursor: pointer;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      background: rgba(255,255,255,0.1);
      position: relative;
    }

    .bookmark-item img {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      box-shadow: 0 2px 8px var(--shadow-color);
      margin-bottom: 4px;
      object-fit: cover;
    }

    .bookmark-item.active {
      background: var(--accent-color);
      color: #000;
    }

    .remove-btn {
      position: absolute;
      top: 4px;
      right: 4px;
      background: transparent;
      border: none;
      color: var(--subtext);
      cursor: pointer;
      font-size: 16px;
    }

    .remove-btn:hover {
      color: var(--red);
    }

    .home-extra {
      margin: 20px 0;
      padding: 16px;
      border-radius: 12px;
      background: var(--card-bg);
      box-shadow: 0 8px 16px var(--shadow-color);
    }

    .home-extra h3 {
      margin-bottom: 12px;
    }

    .quick-links {
      display: flex;
      gap: 8px;
      margin-top: 16px;
    }

    .quick-link {
      padding: 8px 12px;
      background: var(--button-color);
      color: #fff;
      border-radius: 8px;
      text-decoration: none;
    }

    .modal {
      position: fixed;
      inset: 0;
      z-index: 75;
      display: none;
      align-items: center;
      justify-content: center;
      background: color-mix(in oklab, var(--mantle) 70%, black 30%);
      backdrop-filter: blur(10px);
    }

    .modal-inner {
      width: 720px;
      max-width: 92%;
      background: var(--card-bg);
      border: 1px solid var(--surface1);
      border-radius: 14px;
      box-shadow: 0 20px 44px var(--shadow-color);
      padding: 16px;
      display: grid;
      grid-template-columns: 240px 1fr;
      gap: 16px;
    }

    #showsModal .modal-inner {
      grid-template-columns: 1fr;
      gap: 0;
    }

    #showsModal .season-select {
      margin-bottom: 16px;
    }

    #showsModal .season-select select {
      width: 100%;
    }

    #showsModal .episodes-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
      max-height: 60vh;
      overflow-y: auto;
    }

    .update-log {
      position: fixed;
      inset: 0;
      z-index: 80;
      display: none;
      align-items: center;
      justify-content: center;
      background: color-mix(in oklab, var(--mantle) 75%, black 25%);
      backdrop-filter: blur(10px);
      animation: log-fade 0.5s ease;
    }

    @keyframes log-fade {
      from { opacity: 0; transform: scale(0.9); }
      to   { opacity: 1; transform: scale(1); }
    }

    .update-box {
      width: 520px;
      max-width: 90%;
      background: var(--card-bg);
      border: 1px solid var(--surface1);
      border-radius: 12px;
      box-shadow: 0 18px 38px var(--shadow-color);
      padding: 16px;
    }

    .chip {
      display: inline-block;
      margin-right: 6px;
      margin-top: 6px;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(203,166,247,0.18);
      border: 1px solid var(--surface1);
      font-size: 12px;
      color: var(--text-color);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }

    .form-col {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    input[type="color"],
    input[type="text"],
    input[type="url"],
    input[type="number"],
    select {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid var(--surface1);
      background: rgba(49,50,68,0.5);
      color: var(--text-color);
      outline: none;
      transition: box-shadow 0.3s ease;
    }

    input:focus,
    select:focus {
      box-shadow: 0 0 8px var(--accent-color);
    }

    textarea {
      padding: 8px;
      border-radius: 8px;
      border: 1px solid var(--surface1);
      background: rgba(49,50,68,0.5);
      color: var(--text-color);
      outline: none;
      min-height: 80px;
      transition: box-shadow 0.3s ease;
    }

    textarea:focus {
      box-shadow: 0 0 8px var(--accent-color);
    }

    hr {
      border: none;
      border-top: 1px solid var(--surface1);
      margin: 16px 0;
    }

    .recent-menu-btn {
      background: transparent;
      border: none;
      font-size: 20px;
      cursor: pointer;
      color: var(--text-color);
    }

    .recent-dropdown {
      position: absolute;
      background: var(--card-bg);
      border: 1px solid var(--surface1);
      border-radius: 8px;
      box-shadow: 0 8px 20px var(--shadow-color);
      padding: 8px;
      display: none;
      opacity: 0;
      transform: scale(0.9);
      transition: opacity 200ms ease, transform 200ms ease;
      z-index: 10;
    }

    .recent-dropdown.open {
      display: block;
      opacity: 1;
      transform: scale(1);
      animation: dropdown-open 0.2s ease;
    }

    @keyframes dropdown-open {
      from { opacity: 0; transform: scale(0.9); }
      to   { opacity: 1; transform: scale(1); }
    }

    .recent-dropdown button {
      display: block;
      width: 100%;
      text-align: left;
      padding: 8px;
      border: none;
      background: transparent;
      color: var(--text-color);
      cursor: pointer;
    }

    .recent-dropdown button:hover {
      background: var(--surface1);
    }

    /* Movies & Shows grids scroll behavior */
    #moviesGrid,
    #showsGrid {
      overflow-y: auto;
      padding-right: 8px;
      max-height: 70vh;
    }



  #gamesGrid {
  height: auto !important;
 max-height: calc(100vh - 280px) !important;

  overflow-y: auto !important;
  overflow-x: hidden !important;

  display: grid !important;
  gap: 18px !important;
  grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)) !important;
}

    #gamesGrid .card {
      display: flex !important;
      flex-direction: column !important;
      height: auto !important;
      min-height: 260px !important;
      border-radius: 16px !important;
      overflow: hidden !important;
    }

    #gamesGrid .thumb {
      width: 100% !important;
      height: 200px !important;
      min-height: 200px !important;
      background: rgba(255,255,255,0.06) !important;
      border-radius: 12px 12px 0 0 !important;
      overflow: hidden !important;
    }

    #gamesGrid .thumb img {
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
      display: block !important;
    }


#gamesGrid .info {
  padding: 12px !important;
  display: grid !important;
  grid-template-columns: minmax(0, 1fr) auto !important; /* text | star */
  column-gap: 8px !important;
  align-items: center !important;
}

#gamesGrid .info > div:first-child {
  min-width: 0 !important;
}

#gamesGrid .info .title {
  margin-bottom: 4px;
}

#gamesGrid .info .small {
  display: block;
  line-height: 1.2;
}


    #gamesGrid .bookmark-star {
      flex: 0 0 auto !important;
      align-self: flex-start !important;
    }

    #gamesGrid .title,
    #gamesGrid .small {
      white-space: normal !important;
      line-height: 1.2em !important;
    }
#gamesGrid .info {
  padding: 12px !important;
  display: grid !important;
  grid-template-columns: minmax(0, 1fr) auto !important;
  column-gap: 8px !important;
  align-items: center !important;
}

#gamesGrid .info > div:first-child {
  min-width: 0 !important;
}


#gamesGrid .info .title {
  font-size: 0.95em;
  font-weight: 600;
  white-space: normal;
  word-break: break-word;

  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}


#gamesGrid .info .small {
  display: block;
  font-size: 0.8em;
  line-height: 1.2;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}


    #settings.page {
      position: relative !important;
      height: auto !important;
      max-height: none !important;
      min-height: 100dvh !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
      padding-bottom: 140px !important;
    }

    #settings .form-row {
      animation: fade-in 0.5s ease;
    }

    #settings label {
      font-weight: bold;
      color: var(--accent-color);
      text-shadow: 0 1px 2px var(--shadow-color);
    }

    @media screen and (max-width: 1366px) and (max-height: 768px),
           screen and (max-width: 1280px) and (max-height: 800px) {
      body {
        --font-size-base: 15px;
      }

      .grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 14px;
      }

      main {
        padding: 14px;
        max-width: 100%;
      }

      .card .thumb {
        height: 250px;
      }

      .topbar {
        padding: 7px 10px;
      }

      #moviesGrid,
      #showsGrid {
        max-height: 55vh;
      }

      #gamesGrid {
        height: 70vh !important;
      }

      #settings .form-row {
        grid-template-columns: 1fr;
        gap: 12px;
      }

      #settings input,
      #settings select,
      #settings textarea {
        padding: 8px;
        font-size: 15px;
      }

      .profile-dropdown {
        width: 280px;
        font-size: 13px;
        max-height: auto;
        overflow-y: visible;
      }

      .bookmark-item {
        height: auto;
        font-size: 0.9em;
      }

      .bookmark-item img {
        width: 40px;
        height: 40px;
      }

      .btn {
        font-size: 0.9em;
        padding: 8px 10px;
      }
    }
  </style>
</head>
<body class="theme-dashboard">
  <div class="topbar">
    <div class="user-id" id="userIdBtn">
      <div class="avatar"><img id="avatarImg" alt="avatar"></div>
      <div class="username" id="usernameText">User</div>

      <div class="profile-dropdown" id="profileDropdown">
        <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
          <div class="avatar" style="width:48px; height:48px;"><img id="avatarPreview" alt="avatar preview"></div>
          <span class="badge">Profile</span>
        </div>
        <label>Username
          <input type="text" id="profileUsername" placeholder="Enter your username">
        </label>
        <label>Profile Picture URL
          <input type="url" id="profileAvatarUrl" placeholder="https://example.com/me.png">
        </label>
        <label>Description
          <textarea id="profileDescription" placeholder="Tell us about yourself"></textarea>
        </label>
        <div class="profile-actions">
          <button class="btn btn-secondary" id="profileCancel">Cancel</button>
          <button class="btn btn-primary" id="profileSave">Save</button>
        </div>
      </div>
    </div>

    <div id="clock"></div>

    <div class="nav">
      <button data-target="home" class="active"><i class="fas fa-house-chimney"></i> Home</button>
      <button data-target="movies"><i class="fas fa-clapperboard"></i> Movies</button>
      <button data-target="games"><i class="fas fa-ghost"></i> Games</button>
      <button data-target="shows"><i class="fas fa-display"></i> Shows</button>
      <button data-target="proxies"><i class="fas fa-shield-halved"></i> Proxies</button>
      <button data-target="settings"><i class="fas fa-sliders"></i> Settings</button>
    </div>
  </div>

  <main>

    <section id="home" class="page active">
      <div class="home-hero">
        <div class="avatar"><img id="homeAvatar" alt="avatar"></div>
        <div>
          <div style="display:flex; align-items:center; gap:8px;">
            <h2 id="homeUsername" style="margin:0;">Welcome, User</h2>
          </div>
          <p id="homeDescription" class="small" style="margin:6px 0 4px 0;">
            Customize your space with themes, movies, games, music, and more.
          </p>
          <div id="homeGenres"></div>
        </div>
      </div>

      <div class="searchbar" style="margin-top: 20px; margin-bottom: 20px;">
        <input type="text" id="quickSearch" placeholder="Search games and movies...">
        <button class="btn btn-secondary" id="quickSearchBtn">Search</button>
      </div>
      <div id="searchResults" class="grid" style="margin-top: 20px; display: none;"></div>

      <div class="home-panels">
        <div class="home-panel violet">
          <div class="panel-top">
            <span class="tag-label"><i class="fas fa-clapperboard"></i> Movies vault</span>
            <span class="stat" id="homeMovieCount">0</span>
          </div>
          <p class="small">Hand-picked cinema with upgraded art direction. Jump in or let us pick something fresh for you.</p>
          <div class="panel-actions">
            <button class="btn btn-primary" id="homeMoviesBtn">Open Movies</button>
            <button class="btn btn-secondary" id="surpriseMovieBtn">Surprise Me</button>
          </div>
        </div>

        <div class="home-panel emerald">
          <div class="panel-top">
            <span class="tag-label"><i class="fas fa-ghost"></i> Arcade ready</span>
            <span class="stat" id="homeGameCount">0</span>
          </div>
          <p class="small">New styling with richer covers and bookmark flair. Shuffle to a random title or browse the grid.</p>
          <div class="panel-actions">
            <button class="btn btn-primary" id="homeGamesBtn">Open Games</button>
            <button class="btn btn-secondary" id="surpriseGameBtn">Shuffle Game</button>
          </div>
        </div>

        <div class="home-panel">
          <div class="panel-top">
            <span class="tag-label"><i class="fas fa-bookmark"></i> Saved spots</span>
            <span class="stat" id="homeBookmarkCount">0</span>
          </div>
          <p class="small">Reorganized bookmark chips now float to the top of every grid for quick jumps.</p>
          <div class="panel-actions">
            <button class="btn btn-secondary" data-target="movies">Movie Grid</button>
            <button class="btn btn-secondary" data-target="games">Game Grid</button>
          </div>
        </div>
      </div>

      <div class="home-extra">
        <h3>Quick Bookmarks</h3>
        <div class="bookmark-grid" id="bookmarkGrid"></div>
        <div class="quick-links"></div>
      </div>
    </section>


    <section id="movies" class="page">
      <div class="section-hero">
        <div>
          <div class="eyebrow"><i class="fas fa-sparkles"></i> Curated cinema</div>
          <h2 style="margin:4px 0;">Movies</h2>
          <p class="small muted">New glass cards, brighter poster badges, and a refreshed navigator for your saved picks.</p>
          <div class="hero-actions">
            <span class="stat-pill"><i class="fas fa-film"></i> <span id="movieTotalCount">0</span> titles</span>
            <span class="stat-pill accent"><i class="fas fa-star"></i> <span id="movieBookmarkCount">0</span> favorites</span>
          </div>
        </div>
        <div class="hero-buttons">
          <button class="btn btn-secondary" onclick="refreshMovies()">Refresh Grid</button>
          <button class="btn btn-secondary" onclick="clearMovieSearch()">Clear Search</button>
          <button class="btn btn-primary" id="movieSurpriseBtn"><i class="fas fa-wand-magic-sparkles"></i> Random Movie</button>
        </div>
      </div>
      <div class="searchbar">
        <input type="text" id="movieSearch" placeholder="Search movies by title or tag...">
        <button class="btn btn-secondary" onclick="clearMovieSearch()">Clear</button>
      </div>
      <div class="pill-filters" id="movieFilters">
        <button class="pill active" data-filter="all">All</button>
        <button class="pill" data-filter="bookmarked">Bookmarked</button>
        <button class="pill" data-filter="covers">With posters</button>
      </div>
      <div class="grid media-grid" id="moviesGrid"></div>
    </section>


    <section id="games" class="page">
      <div class="section-hero">
        <div>
          <div class="eyebrow"><i class="fas fa-ghost"></i> Neon arcade</div>
          <h2 style="margin:4px 0;">Games</h2>
          <p class="small muted">Infinite scroll stays, but cards now glow with richer thumbs and clearer bookmark hits.</p>
          <div class="hero-actions">
            <span class="stat-pill"><i class="fas fa-gamepad"></i> <span id="gameTotalCount">0</span> titles</span>
            <span class="stat-pill accent"><i class="fas fa-heart"></i> <span id="gameBookmarkCount">0</span> favorites</span>
          </div>
        </div>
        <div class="hero-buttons">
          <button class="btn btn-secondary" onclick="resetGames()">Reset List</button>
          <button class="btn btn-secondary" onclick="clearGameSearch()">Clear Search</button>
          <button class="btn btn-primary" id="gameSurpriseBtn"><i class="fas fa-dice"></i> Shuffle Game</button>
        </div>
      </div>
      <div class="searchbar">
        <input type="text" id="gameSearch" placeholder="Search games by title...">
        <button class="btn btn-secondary" onclick="clearGameSearch()">Clear</button>
      </div>
      <div class="pill-filters" id="gameFilters">
        <button class="pill active" data-filter="all">All</button>
        <button class="pill" data-filter="bookmarked">Bookmarked</button>
        <button class="pill" data-filter="cover">With art</button>
        <button class="pill" data-filter="playable">Playable links</button>
      </div>
      <div class="grid media-grid" id="gamesGrid"></div>
    </section>

    <section id="shows" class="page">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <h2>Shows (Experimental)</h2>
        <div style="display:flex; gap:8px;">
          <button class="btn btn-secondary" onclick="resetShows()">Reset</button>
        </div>
      </div>
      <div class="searchbar">
        <input type="text" id="showSearch" placeholder="Search shows by title or tag...">
        <button class="btn btn-secondary" onclick="clearShowSearch()">Clear</button>
      </div>
      <div class="grid" id="showsGrid"></div>
    </section>

    <section id="proxies" class="page">
      <h2>Proxies</h2>
      <div class="list" id="proxiesList"></div>
    </section>


    <section id="settings" class="page">
      <h2>Settings</h2>
      <p class="small muted">
        Customize background, colors, theme, tab cloaker, and auto-update. Settings persist in localStorage.
      </p>

      <div class="form-row">
        <div class="form-col">
          <label>Background Color
            <input type="color" id="bgColorPicker">
          </label>
        </div>
        <div class="form-col">
          <label>Background Image URL
            <input type="url" id="bgImageUrl" placeholder="https://example.com/background.jpg">
          </label>
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label>Default Wallpapers
            <select id="defaultWallpaperSelect">
              <option value="">Select wallpaper...</option>
              <option value="https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/0b7ebb06-0ab5-459f-9d0d-6f2328f513e7/diya3mv-f512d108-fd65-45fb-aa3a-88b2531c74b1.gif?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOjdlMGQxODg5ODIyNjQzNzNhNWYwZDQxNWVhMGQyNmUwIiwiaXNzIjoidXJuOmFwcDo3ZTBkMTg4OTgyMjY0MzczYTVmMGQ0MTVlYTBkMjZlMCIsIm9iaiI6W1t7InBhdGgiOiIvZi8wYjdlYmIwNi0wYWI1LTQ1OWYtOWQwZC02ZjIzMjhmNTEzZTcvZGl5YTNtdi1mNTEyZDEwOC1mZDY1LTQ1ZmItYWEzYS04OGIyNTMxYzc0YjEuZ2lmIn1dXSwiYXVkIjpbInVybjpzZXJ2aWNlOmZpbGUuZG93bmxvYWQiXX0.2gQNIgE234v9Ilxy8bsAn8glgmG7wBKsmwTESKA_MGU">Ghostface Wallpaper</option>
            </select>
          </label>
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label>Overall Theme Color
            <input type="color" id="overallThemeColor">
          </label>
        </div>
        <div class="form-col">
          <label>Accent Color
            <input type="color" id="accentColorPicker">
          </label>
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label>Button Color
            <input type="color" id="buttonColorPicker">
          </label>
        </div>
        <div class="form-col">
          <label>Text Color
            <input type="color" id="textColorPicker">
          </label>
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label>Effect Color
            <input type="color" id="effectColorPicker">
          </label>
        </div>
        <div class="form-col">
          <label>Preset Theme
            <select id="presetThemeSelect">
              <option value="">Select preset...</option>
              <option value="dashboard">Dashboard (Fancy)</option>
              <option value="dark">Dark</option>
              <option value="nordic-dark">Nordic Dark</option>
              <option value="sweet">Sweet</option>
              <option value="chrome-os">Chrome OS</option>
              <option value="dracula">Dracula</option>
              <option value="undertale">Undertale</option>
              <option value="macos-sonoma-dark">macOS Sonoma Dark</option>
              <option value="candy">Candy</option>
              <option value="fallout">Fallout Pip-Boy</option>
              <option value="void">Void</option>
              <option value="shadowrealm">Shadow Realm</option>
              <option value="eclipse">Eclipse</option>
            </select>
          </label>
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label>Preserve Background on Theme Change
            <input type="checkbox" id="preserveBgToggle">
          </label>
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label>Viewer Width (%)
            <input type="number" id="viewerWidthInput" min="50" max="100" value="98">
          </label>
        </div>
        <div class="form-col">
          <label>Viewer Height (%)
            <input type="number" id="viewerHeightInput" min="50" max="100" value="98">
          </label>
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label>Panic Key (e.g., Escape)
            <input type="text" id="panicKeyInput" placeholder="Escape">
          </label>
        </div>
        <div class="form-col">
          <label>Panic Redirect URL
            <input type="url" id="panicUrlInput" placeholder="https://www.google.com">
          </label>
        </div>
      </div>

      <div class="form-row">
        <div class="form-col">
          <label>Font Size (px)
            <input type="number" id="fontSizeInput" min="12" max="20" value="16">
          </label>
        </div>
        <div class="form-col">
          <label>Performance Mode (for Chromebooks)
            <select id="performanceModeSelect">
              <option value="0">Off</option>
              <option value="1">On</option>
            </select>
          </label>
        </div>
      </div>

      <hr>

      <h3>Tab Cloaker</h3>
      <div class="form-row">
        <div class="form-col">
          <label>Tab Title
            <input type="text" id="tabTitleInput" placeholder="e.g., Google">
          </label>
        </div>
        <div class="form-col">
          <label>Favicon Image URL
            <input type="url" id="tabIconInput" placeholder="https://www.google.com/favicon.ico">
          </label>
        </div>
      </div>
      <div style="display:flex; gap:8px; margin-bottom:12px;">
        <button class="btn btn-primary" id="applyTabCloakBtn">Apply Cloak</button>
        <button class="btn btn-secondary" id="cloakGoogleBtn">Cloak as Google</button>
        <button class="btn btn-secondary" id="cloakCanvasBtn">Cloak as Dashboard</button>
        <button class="btn btn-secondary" id="resetCloakBtn">Reset Cloak</button>
      </div>

      <div style="display:flex; gap:8px;">
        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
        <button class="btn btn-secondary" onclick="resetSettings()">Reset to Default</button>
      </div>
    </section>
  </main>


  <div class="overlay" id="overlay">
    <div class="viewer" id="viewer">
      <div class="viewer-header" id="viewerHeader">
        <div class="viewer-title" id="viewerTitle">Viewer</div>
        <div style="display:flex; gap:8px;" id="viewerHeaderBtns">
          <button class="icon-btn" id="fullscreenBtn">Fullscreen</button>
          <button class="icon-btn" id="closeOverlayBtn">Close</button>
        </div>
      </div>
      <iframe class="viewer-iframe" id="viewerIframe"
        allowfullscreen
        sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-downloads"
        allow="autoplay; fullscreen; encrypted-media; picture-in-picture"></iframe>
    </div>
  </div>


  <div class="update-log" id="updateLog">
    <div class="update-box">
      <div style="display:flex; align-items:center; justify-content:space-between;">
        <h3 style="margin:0;">Update Log</h3>
        <span class="badge" id="versionLabel">v3.2</span>
      </div>
      <p class="small">What's new:</p>
      <ul style="list-style: disc; padding-left: 20px;">
        <li>Fixed Games Overlapping Below Page</li>
        <li>Added Rest Of The Movies</li>
        <li>Fixed Bookmarks Not Displaying On Startup</li>
      </ul>
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button class="btn btn-primary" id="closeLogBtn">Close</button>
      </div>
    </div>
  </div>


  <div class="modal" id="showsModal">
    <div class="modal-inner">
      <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:12px;">
        <h3 id="showsModalTitle" style="margin:0;">Show Episodes</h3>
        <button class="icon-btn" id="showsModalClose">Close</button>
      </div>
      <div class="form-col season-select">
        <label>Season
          <select id="seasonDropdown"></select>
        </label>
      </div>
      <div class="searchbar">
        <input type="text" id="episodeSearch" placeholder="Search episodes by title...">
        <button class="btn btn-secondary" onclick="clearEpisodeSearch()">Clear</button>
      </div>
      <div class="episodes-grid" id="episodesGrid"></div>
    </div>
  </div>

  <script>
    const LS_KEYS = {
      theme: 'themeSettings',
      currentTheme: 'currentThemeName',
      profile: 'userProfile',
      movies: 'moviesList',
      games: 'gamesList',
      shows: 'showsList',
      recentViews: 'recentViews',
      recentHidden: 'recentHidden',
      tabCloak: 'tabCloakSettings',
      viewerWidth: 'viewerWidth',
      viewerHeight: 'viewerHeight',
      panicKey: 'panicKey',
      panicUrl: 'panicUrl',
      fontSize: 'fontSize',
      performanceMode: 'performanceMode',
      proxies: 'proxiesList',
      preserveBgOnTheme: 'preserveBgOnTheme',
      bookmarks: 'bookmarks'
    };

    const defaultTheme = {
      bgColor: getComputedStyle(document.documentElement).getPropertyValue('--base').trim() || '#1E1E2E',
      bgImage: '',
      overallThemeColor: getComputedStyle(document.documentElement).getPropertyValue('--mauve').trim() || '#CBA6F7',
      accentColor: getComputedStyle(document.documentElement).getPropertyValue('--mauve').trim() || '#CBA6F7',
      buttonColor: getComputedStyle(document.documentElement).getPropertyValue('--blue').trim() || '#89B4FA',
      textColor: getComputedStyle(document.documentElement).getPropertyValue('--text').trim() || '#CDD6F4',
      effectColor: 'rgba(203,166,247,0.3)'
    };

    const defaultProfile = {
      username: 'User',
      description: 'Customize your space with themes, movies, games, music, and more.',
      avatarUrl: ''
    };

    const defaultMovies = [








  ];
    
    const defaultShows = [
      {
        title: 'Steven Universe',
        seasons: [
          {
            season: 1,
            episodes: [
              {
                number: 1,
                title: 'Episode 1',
                url: 'https://drive.google.com/file/d/example1/preview',
                coverUrl: '',
                tags: ['Action'],
                description: 'The first episode of the series.'
              }
            ]
          }
        ],
        tags: ['PlaceHolder'],
        description: 'A thrilling series with action and synthwave vibes.',
        coverUrl: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQnS51LdsXK6aKhDvuJzm04zQ48qfyrmeEl3UoB_lQzKh1oXQizdfivZ-K6AYB56g3Cm0cY1w&s=10'
      }
    ];

    const defaultProxies = [
      { title: 'Galaxy', url: 'https://galxy.autos.cdn.cloudflare.net/', description: 'A drak themed Proxy' },
       { title: 'Void Network', url: 'https://void.radio.fm.cdn.cloudflare.net/', description: 'A dark themed Proxy' },
        { title: 'Vortex', url: 'https://void.radio.fm.cdn.cloudflare.net/', description: 'Needs Registering' },
         { title: 'Frogies Arcade', url: 'https://powerschool.nsd160.org.cdn.cloudflare.net/', description: '' },
           { title: 'DaydreamX', url: 'https://daydreamx.pro.cdn.cloudflare.net/', description: '' },

    ];

    function saveJson(key, obj) {
      try { localStorage.setItem(key, JSON.stringify(obj)); } catch (e) {}
    }

    function loadJson(key, fallback) {
      try {
        const raw = localStorage.getItem(key);
        if (raw == null) return fallback;
        return JSON.parse(raw);
      } catch (e) {
        return fallback;
      }
    }

    function rgbToHex(rgb) {
      if (!rgb) return '#000000';
      rgb = rgb.trim();
      if (rgb.startsWith('#')) return rgb;
      const m = rgb.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);
      if (!m) return '#000000';
      return '#' + [m[1], m[2], m[3]].map(x => parseInt(x, 10).toString(16).padStart(2, '0')).join('');
    }

    function hexToRgba(hex, a = 1) {
      hex = hex.replace('#', '');
      if (hex.length === 3) hex = hex.split('').map(c => c + c).join('');
      const r = parseInt(hex.slice(0,2),16),
            g = parseInt(hex.slice(2,4),16),
            b = parseInt(hex.slice(4,6),16);
      return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + a + ')';
    }

    function extractRGB(str) {
      const m = String(str || '').match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/i);
      if (!m) return null;
      return 'rgb(' + m[1] + ', ' + m[2] + ', ' + m[3] + ')';
    }

    const DEFAULT_AVATAR = 'https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png';

    let theme = loadJson(LS_KEYS.theme, defaultTheme);
    let currentThemeName = localStorage.getItem(LS_KEYS.currentTheme) || 'dashboard';
    let profile = loadJson(LS_KEYS.profile, defaultProfile);
    let movies = loadJson(LS_KEYS.movies, defaultMovies);
    let games = loadJson(LS_KEYS.games, defaultGames);
    let shows = loadJson(LS_KEYS.shows, defaultShows);
    let proxies = loadJson(LS_KEYS.proxies, defaultProxies);
    let recentViews = loadJson(LS_KEYS.recentViews, []);
    let recentHidden = localStorage.getItem(LS_KEYS.recentHidden) === 'true';
    let cloak = loadJson(LS_KEYS.tabCloak, { title: document.title, icon: '' });
    let preserveBgOnTheme = localStorage.getItem(LS_KEYS.preserveBgOnTheme) === 'true';
    let bookmarks = loadJson(LS_KEYS.bookmarks, []);

    let movieQuery = '';
    let movieFilter = 'all';
    let gameQuery = '';
    let gameFilter = 'all';
    let showQuery = '';
    let currentShowIndex = null;
    let episodeQuery = '';
    let currentSeason = null;

    let viewerOpen = false;

    function applyTheme(t = theme, themeName = currentThemeName) {
      const root = document.documentElement;
      root.style.setProperty('--bg-color', t.bgColor || defaultTheme.bgColor);
      root.style.setProperty('--bg-image', t.bgImage && t.bgImage.trim().length > 6 ? 'url("' + t.bgImage + '")' : 'none');
      root.style.setProperty('--text-color', t.textColor || defaultTheme.textColor);
      root.style.setProperty('--accent-color', t.accentColor || defaultTheme.accentColor);
      root.style.setProperty('--button-color', t.buttonColor || defaultTheme.buttonColor);
      root.style.setProperty('--effect-color', t.effectColor || defaultTheme.effectColor);
      root.style.setProperty('--nav-active', t.overallThemeColor || t.accentColor || defaultTheme.accentColor);

      document.body.className = '';
      if (themeName) document.body.classList.add('theme-' + themeName);

      const clockEl = document.getElementById('clock');
      if (clockEl) clockEl.style.display = 'block';
    }

    function presetTheme(name) {
      let t = JSON.parse(JSON.stringify(defaultTheme));
      let previousBgImage = theme.bgImage;
      let previousBgColor = theme.bgColor;
      let bgImageToUse = preserveBgOnTheme ? previousBgImage : '';
      let bgColorToUse = preserveBgOnTheme ? previousBgColor : defaultTheme.bgColor;

      if (name === 'dashboard') {
        t.bgColor = 'linear-gradient(135deg, #1b1032 0%, #2e1a4a 50%, #1b1032 100%)';
        t.textColor = '#ffffff';
        t.accentColor = '#8b5cf6';
        t.buttonColor = '#6d28d9';
        t.overallThemeColor = '#7c3aed';
        t.effectColor = 'rgba(139,92,246,0.3)';
        t.bgImage = bgImageToUse;
      } else if (name === 'dark') {
        t.bgColor = 'linear-gradient(135deg, #1E1E2E 0%, #313244 50%, #1E1E2E 100%)';
        t.textColor = '#CDD6F4';
        t.accentColor = '#CBA6F7';
        t.buttonColor = '#89B4FA';
        t.overallThemeColor = '#CBA6F7';
        t.effectColor = 'rgba(203,166,247,0.3)';
        t.bgImage = bgImageToUse;
      } else if (name === 'nordic-dark') {
        t.bgColor = 'linear-gradient(135deg, #2E3440 0%, #434C5E 50%, #2E3440 100%)';
        t.textColor = '#D8DEE9';
        t.accentColor = '#5E81AC';
        t.buttonColor = '#4C566A';
        t.overallThemeColor = '#81A1C1';
        t.effectColor = 'rgba(94,129,172,0.3)';
        t.bgImage = bgImageToUse;
      } else if (name === 'sweet') {
        t.bgColor = 'linear-gradient(135deg, #FDDDE6 0%, #FFB6C1 50%, #FDDDE6 100%)';
        t.textColor = '#E0BBE4';
        t.accentColor = '#957FB8';
        t.buttonColor = '#DDA0DD';
        t.overallThemeColor = '#CDA2D0';
        t.effectColor = 'rgba(149,127,184,0.3)';
        t.bgImage = bgImageToUse;
      } else if (name === 'chrome-os') {
        t.bgColor = 'linear-gradient(135deg, #202124 0%, #3C4043 50%, #202124 100%)';
        t.textColor = '#E8EAED';
        t.accentColor = '#4285F4';
        t.buttonColor = '#1A73E8';
        t.overallThemeColor = '#34A853';
        t.effectColor = 'rgba(66,133,244,0.3)';
        t.bgImage = bgImageToUse;
      } else if (name === 'dracula') {
        t.bgColor = 'linear-gradient(135deg, #282A36 0%, #44475A 50%, #282A36 100%)';
        t.textColor = '#F8F8F2';
        t.accentColor = '#BD93F9';
        t.buttonColor = '#FF79C6';
        t.overallThemeColor = '#50FA7B';
        t.effectColor = 'rgba(189,147,249,0.3)';
        t.bgImage = bgImageToUse;
      } else if (name === 'undertale') {
        t.bgColor = 'linear-gradient(135deg, #000000 0%, #1A1A1A 50%, #000000 100%)';
        t.textColor = '#FFFFFF';
        t.accentColor = '#FF0000';
        t.buttonColor = '#FFFF00';
        t.overallThemeColor = '#FF0000';
        t.effectColor = 'rgba(255,0,0,0.5)';
        t.bgImage = bgImageToUse;
      } else if (name === 'macos-sonoma-dark') {
        t.bgColor = 'linear-gradient(135deg, #1C1C1E 0%, #2C2C2E 50%, #1C1C1E 100%)';
        t.textColor = '#FFFFFF';
        t.accentColor = '#0A84FF';
        t.buttonColor = '#007AFF';
        t.overallThemeColor = '#0A84FF';
        t.effectColor = 'rgba(10,132,255,0.3)';
        t.bgImage = bgImageToUse;
      } else if (name === 'candy') {
        t.bgColor = 'linear-gradient(135deg, #FFD1DC 0%, #FFB6C1 50%, #FFD1DC 100%)';
        t.textColor = '#4B0082';
        t.accentColor = '#FF69B4';
        t.buttonColor = '#FFC0CB';
        t.overallThemeColor = '#FF1493';
        t.effectColor = 'rgba(255,105,180,0.3)';
        t.bgImage = bgImageToUse;
      } else if (name === 'fallout') {
        t.bgColor = 'linear-gradient(135deg, #003300 0%, #004d00 50%, #003300 100%)';
        t.textColor = '#00FF00';
        t.accentColor = '#00CC00';
        t.buttonColor = '#006600';
        t.overallThemeColor = '#00FF00';
        t.effectColor = 'rgba(0,255,0,0.3)';
        t.bgImage = bgImageToUse;
      } else if (name === 'void') {
        t.bgColor = 'linear-gradient(135deg, #000000 0%, #111111 50%, #000000 100%)';
        t.textColor = '#888888';
        t.accentColor = '#333333';
        t.buttonColor = '#111111';
        t.overallThemeColor = '#444444';
        t.effectColor = 'rgba(0,0,0,0.5)';
        t.bgImage = bgImageToUse;
      } else if (name === 'shadowrealm') {
        t.bgColor = 'linear-gradient(135deg, #0D0D0D 0%, #1A1A1A 50%, #0D0D0D 100%)';
        t.textColor = '#A9A9A9';
        t.accentColor = '#4B0082';
        t.buttonColor = '#301934';
        t.overallThemeColor = '#4B0082';
        t.effectColor = 'rgba(75,0,130,0.3)';
        t.bgImage = bgImageToUse;
      } else if (name === 'eclipse') {
        t.bgColor = 'linear-gradient(135deg, #121212 0%, #1F1F1F 50%, #121212 100%)';
        t.textColor = '#D3D3D3';
        t.accentColor = '#FF4500';
        t.buttonColor = '#8B0000';
        t.overallThemeColor = '#FF4500';
        t.effectColor = 'rgba(255,69,0,0.3)';
        t.bgImage = bgImageToUse;
      }

      theme = t;
      saveJson(LS_KEYS.theme, theme);
      localStorage.setItem(LS_KEYS.currentTheme, name);
      currentThemeName = name;
      applyTheme(t, name);
      bindSettingsForm();
    }

    function showPage(id) {
      document.querySelectorAll('.nav button').forEach(btn =>
        btn.classList.toggle('active', btn.dataset.target === id)
      );
      document.querySelectorAll('section.page').forEach(sec =>
        sec.classList.toggle('active', sec.id === id)
      );

      document.body.classList.toggle('page-no-scroll', ['movies', 'games'].includes(id));

      if (id === 'games') {
        // Reset and render games again (first chunk)
        infiniteGamesIndex = 0;
        renderGames(true);
      } else if (id === 'movies') {
        renderMovies();
      } else if (id === 'shows') {
        renderShows();
      } else if (id === 'home') {
        updateClock();
        renderBookmarks();
      } else if (id === 'proxies') {
        renderProxies();
      }
    }

    function renderProfile() {
      document.getElementById('usernameText').textContent = profile.username || 'User';
      document.getElementById('homeUsername').textContent = 'Welcome, ' + (profile.username || 'User');
      document.getElementById('homeDescription').textContent =
        profile.description || defaultProfile.description;

      const avatarUrl = profile.avatarUrl || DEFAULT_AVATAR;

      document.getElementById('avatarImg').src = avatarUrl;
      document.getElementById('avatarPreview').src = avatarUrl;
      document.getElementById('homeAvatar').src = avatarUrl;

      document.getElementById('profileUsername').value = profile.username || '';
      document.getElementById('profileAvatarUrl').value = profile.avatarUrl || '';
      document.getElementById('profileDescription').value = profile.description || '';
    }

    function initProfileDropdown() {
      const userIdBtn = document.getElementById('userIdBtn');
      const dropdown = document.getElementById('profileDropdown');

      userIdBtn.addEventListener('click', function(e) {
        if (e.target.closest('.profile-dropdown')) return;
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
      });

      document.getElementById('profileCancel').addEventListener('click', function() {
        dropdown.style.display = 'none';
        renderProfile();
      });

      document.getElementById('profileSave').addEventListener('click', function() {
        profile.username = document.getElementById('profileUsername').value.trim() || 'User';
        profile.avatarUrl = document.getElementById('profileAvatarUrl').value.trim();
        profile.description = document.getElementById('profileDescription').value.trim();
        saveJson(LS_KEYS.profile, profile);
        renderProfile();
        dropdown.style.display = 'none';
      });

      document.getElementById('profileAvatarUrl').addEventListener('input', function(e) {
        document.getElementById('avatarPreview').src = e.target.value.trim() || DEFAULT_AVATAR;
      });

      document.addEventListener('click', function(e) {
        if (!e.target.closest('#userIdBtn')) dropdown.style.display = 'none';
      });
    }

    function isBookmarked(type, originalIdx) {
      return bookmarks.some(b => b.type === type && b.idx === originalIdx);
    }

    function updateMovieStats(filteredCount = movies.length) {
      const favs = bookmarks.filter(b => b.type === 'movie').length;
      const totalEl = document.getElementById('movieTotalCount');
      const favEl = document.getElementById('movieBookmarkCount');
      if (totalEl) totalEl.textContent = filteredCount + ' / ' + movies.length;
      if (favEl) favEl.textContent = favs;
    }

    function updateGameStats(filteredCount = games.length) {
      const favs = bookmarks.filter(b => b.type === 'game').length;
      const totalEl = document.getElementById('gameTotalCount');
      const favEl = document.getElementById('gameBookmarkCount');
      if (totalEl) totalEl.textContent = filteredCount + ' / ' + games.length;
      if (favEl) favEl.textContent = favs;
    }

    function updateHomeStats() {
      const setText = (id, value) => {
        const el = document.getElementById(id);
        if (el) el.textContent = value;
      };

      setText('homeMovieCount', movies.length);
      setText('homeGameCount', games.length);
      setText('homeBookmarkCount', bookmarks.length);
    }



    function movieMatchesFilter(m) {
      const originalIdx = movies.indexOf(m);
      if (movieFilter === 'bookmarked' && !isBookmarked('movie', originalIdx)) return false;
      if (movieFilter === 'covers' && !m.coverUrl) return false;
      return true;
    }

    function renderMovies() {
      const grid = document.getElementById('moviesGrid');
      grid.innerHTML = '';

      let items = movies.filter(function(m) {
        const q = movieQuery.toLowerCase();
        const matchesQuery = (m.title || '').toLowerCase().includes(q) ||
          (m.tags || []).some(tag => tag.toLowerCase().includes(q));
        return matchesQuery && movieMatchesFilter(m);
      });

      // Bookmarked movies first
      items.sort((a, b) => {
        const aIdx = movies.indexOf(a);
        const bIdx = movies.indexOf(b);
        const aBookmarked = isBookmarked('movie', aIdx) ? 1 : 0;
        const bBookmarked = isBookmarked('movie', bIdx) ? 1 : 0;
        return bBookmarked - aBookmarked;
      });

      updateMovieStats(items.length);
      updateHomeStats();

      items.forEach(function(m) {
        const originalIdx = movies.indexOf(m);
        const card = document.createElement('div');
        card.className = 'card media-card';

        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        thumb.style.position = 'relative';
        if (m.coverUrl) {
          const img = document.createElement('img');
          img.src = m.coverUrl;
          thumb.appendChild(img);
        } else {
          thumb.textContent = m.title;
        }
        if (isBookmarked('movie', originalIdx)) {
          const badge = document.createElement('span');
          badge.className = 'badge';
          badge.textContent = 'Saved';
          thumb.appendChild(badge);
        }
        thumb.addEventListener('click', function() {
          openViewer(m.title, m.driveLink, 'movie');
        });

        const info = document.createElement('div');
        info.className = 'info';

        const left = document.createElement('div');
        const titleDiv = document.createElement('div');
        titleDiv.className = 'title';
        titleDiv.textContent = m.title;



        const tagsDiv = document.createElement('div');
        tagsDiv.className = 'tags';
        (m.tags || []).forEach(tag => {
          const tagSpan = document.createElement('span');
          tagSpan.className = 'tag';
          tagSpan.textContent = tag;
          tagsDiv.appendChild(tagSpan);
        });

        left.appendChild(titleDiv);
        left.appendChild(tagsDiv);

        const bookmarkStar = document.createElement('span');
        bookmarkStar.className = 'bookmark-star';
        bookmarkStar.innerHTML = '';
        bookmarkStar.classList.toggle('active', isBookmarked('movie', originalIdx));
        bookmarkStar.addEventListener('click', function(e) {
          e.stopPropagation();
          toggleBookmark('movie', originalIdx, m.title);
          bookmarkStar.classList.toggle('active');
          renderBookmarks();
        });

        info.appendChild(left);
        info.appendChild(bookmarkStar);

        card.appendChild(thumb);
        card.appendChild(info);
        grid.appendChild(card);
      });
    }

    function refreshMovies() {
      renderMovies();
    }

    function clearMovieSearch() {
      movieQuery = '';
      document.getElementById('movieSearch').value = '';
      renderMovies();
    }

    document.getElementById('movieSearch').addEventListener('input', function(e) {
      movieQuery = e.target.value.trim();
      renderMovies();
    });

    function surpriseMovie() {
      const pool = movies.filter(m => movieMatchesFilter(m) && (
        (m.title || '').toLowerCase().includes(movieQuery.toLowerCase()) ||
        (m.tags || []).some(tag => tag.toLowerCase().includes(movieQuery.toLowerCase()))
      ));
      if (!pool.length) return;
      const pick = pool[Math.floor(Math.random() * pool.length)];
      openViewer(pick.title, pick.driveLink, 'movie');
    }



    let infiniteGamesIndex = 0;
    const GAMES_CHUNK = 60;
    let gamesScrollAttached = false;

    function getFilteredSortedGames() {
      let filtered = games.filter(g =>
        g && (g.title || '').toLowerCase().includes((gameQuery || '').toLowerCase())
      ).filter(g => {
        const originalIdx = games.indexOf(g);
        if (gameFilter === 'bookmarked' && !isBookmarked('game', originalIdx)) return false;
        if (gameFilter === 'cover') {
          const thumbUrl = g.iconUrl || g.coverUrl || g.thumbnail || g.img || g.image || '';
          if (!thumbUrl) return false;
        }
        if (gameFilter === 'playable' && !g.src) return false;
        return true;
      });

      // Sort so bookmarked games show first (on initial full render)
      filtered.sort((a, b) => {
        const aIdx = games.indexOf(a);
        const bIdx = games.indexOf(b);
        const aBookmarked = isBookmarked('game', aIdx) ? 1 : 0;
        const bBookmarked = isBookmarked('game', bIdx) ? 1 : 0;
        return bBookmarked - aBookmarked;
      });

      return filtered;
    }

    function renderGames(initial = false) {
      const grid = document.getElementById('gamesGrid');
      if (!grid) return;

      const filteredGames = getFilteredSortedGames();
      updateGameStats(filteredGames.length);
      updateHomeStats();

      if (initial) {
        grid.innerHTML = '';
        infiniteGamesIndex = 0;
      }

      if (infiniteGamesIndex >= filteredGames.length) return;

      const slice = filteredGames.slice(infiniteGamesIndex, infiniteGamesIndex + GAMES_CHUNK);
      infiniteGamesIndex += slice.length;

      slice.forEach(g => {
        if (!g || !g.title) return;
        const originalIdx = games.indexOf(g);

        const card = document.createElement('div');
        card.className = 'card media-card';

        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        thumb.style.position = 'relative';


        const thumbUrl =
          g.iconUrl ||
          g.coverUrl ||
          g.thumbnail ||
          g.img ||
          g.image ||
          '';

        if (thumbUrl) {
          const img = document.createElement('img');
          img.src = thumbUrl;
          thumb.appendChild(img);
        } else {
          const placeholder = document.createElement('div');
          placeholder.style.fontSize = '32px';
          placeholder.textContent = '';
          thumb.appendChild(placeholder);
        }

        if (isBookmarked('game', originalIdx)) {
          const badge = document.createElement('span');
          badge.className = 'badge';
          badge.textContent = 'Saved';
          thumb.appendChild(badge);
        }

        thumb.addEventListener('click', () => {
          if (!viewerOpen) openViewer(g.title, g.src, 'game');
        });

        const info = document.createElement('div');
        info.className = 'info';

        const left = document.createElement('div');
        const titleDiv = document.createElement('div');
        titleDiv.className = 'title';
        titleDiv.textContent = g.title;



        left.appendChild(titleDiv);


        const star = document.createElement('span');
        star.className = 'bookmark-star';
        star.innerHTML = '';
        star.classList.toggle('active', isBookmarked('game', originalIdx));
        star.addEventListener('click', (ev) => {
          ev.stopPropagation();
          toggleBookmark('game', originalIdx, g.title);
          star.classList.toggle('active');
          renderBookmarks();
        });

        info.appendChild(left);
        info.appendChild(star);

        card.appendChild(thumb);
        card.appendChild(info);
        grid.appendChild(card);
      });


      if (grid.scrollHeight <= grid.clientHeight + 5 && infiniteGamesIndex < filteredGames.length) {
        renderGames(false);
      }
    }

    function setupGameInfiniteScroll() {
      const grid = document.getElementById('gamesGrid');
      if (!grid || gamesScrollAttached) return;
      gamesScrollAttached = true;

      grid.addEventListener('scroll', function() {
        const nearBottom = grid.scrollTop + grid.clientHeight >= grid.scrollHeight - 120;
        if (nearBottom) {
          renderGames(false);
        }
      });
    }

    function resetGames() {
      if (!confirm('Reset games list to defaults?')) return;
      games = defaultGames.slice();
      saveJson(LS_KEYS.games, games);
      infiniteGamesIndex = 0;
      renderGames(true);
    }

    function clearGameSearch() {
      gameQuery = '';
      document.getElementById('gameSearch').value = '';
      infiniteGamesIndex = 0;
      renderGames(true);
    }

    function surpriseGame() {
      const filtered = getFilteredSortedGames();
      if (!filtered.length) return;
      const pick = filtered[Math.floor(Math.random() * filtered.length)];
      if (!viewerOpen) openViewer(pick.title, pick.src, 'game');
    }

    document.getElementById('gameSearch').addEventListener('input', function(e) {
      gameQuery = e.target.value.trim();
      infiniteGamesIndex = 0;
      renderGames(true);
    });



    function renderShows() {
      const grid = document.getElementById('showsGrid');
      grid.innerHTML = '';

      let items = shows.filter(function(s) {
        const q = showQuery.toLowerCase();
        return (s.title || '').toLowerCase().includes(q) ||
          (s.tags || []).some(tag => tag.toLowerCase().includes(q));
      });

      items.sort((a, b) => {
        const aIdx = shows.indexOf(a);
        const bIdx = shows.indexOf(b);
        const aBookmarked = isBookmarked('show', aIdx) ? 1 : 0;
        const bBookmarked = isBookmarked('show', bIdx) ? 1 : 0;
        return bBookmarked - aBookmarked;
      });

      items.forEach(function(show) {
        const originalIdx = shows.indexOf(show);

        const card = document.createElement('div');
        card.className = 'card';

        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        if (show.coverUrl) {
          const img = document.createElement('img');
          img.src = show.coverUrl;
          thumb.appendChild(img);
        } else {
          thumb.textContent = show.title;
        }

        thumb.addEventListener('click', function() {
          openShowsModal(originalIdx);
        });

        const info = document.createElement('div');
        info.className = 'info';

        const left = document.createElement('div');
        const titleDiv = document.createElement('div');
        titleDiv.className = 'title';
        titleDiv.textContent = show.title;

        const sub = document.createElement('div');
        sub.className = 'small muted';
        sub.textContent = 'Click to view episodes';

        const tagsDiv = document.createElement('div');
        tagsDiv.className = 'tags';
        (show.tags || []).forEach(tag => {
          const tagSpan = document.createElement('span');
          tagSpan.className = 'tag';
          tagSpan.textContent = tag;
          tagsDiv.appendChild(tagSpan);
        });

        left.appendChild(titleDiv);
        left.appendChild(sub);
        left.appendChild(tagsDiv);

        const bookmarkStar = document.createElement('span');
        bookmarkStar.className = 'bookmark-star';
        bookmarkStar.innerHTML = '';
        bookmarkStar.classList.toggle('active', isBookmarked('show', originalIdx));
        bookmarkStar.addEventListener('click', function(e) {
          e.stopPropagation();
          toggleBookmark('show', originalIdx, show.title);
          bookmarkStar.classList.toggle('active');
          renderBookmarks();
        });

        info.appendChild(left);
        info.appendChild(bookmarkStar);

        card.appendChild(thumb);
        card.appendChild(info);
        grid.appendChild(card);
      });
    }

    function clearShowSearch() {
      showQuery = '';
      document.getElementById('showSearch').value = '';
      renderShows();
    }

    document.getElementById('showSearch').addEventListener('input', function(e) {
      showQuery = e.target.value.trim();
      renderShows();
    });

    let episodeSearchInput;
    let seasonDropdown;

    function openShowsModal(idx) {
      currentShowIndex = idx;
      const show = shows[idx];
      document.getElementById('showsModalTitle').textContent = show.title;

      episodeQuery = '';
      currentSeason = show.seasons[0] ? show.seasons[0].season : 1;

      seasonDropdown = document.getElementById('seasonDropdown');
      populateSeasonDropdown(show);
      renderEpisodesGrid();

      const modal = document.getElementById('showsModal');
      modal.style.display = 'flex';
      document.body.classList.add('no-scroll');

      episodeSearchInput = document.getElementById('episodeSearch');
      episodeSearchInput.value = '';
      episodeSearchInput.addEventListener('input', function(e) {
        episodeQuery = e.target.value.trim();
        renderEpisodesGrid();
      });

      seasonDropdown.addEventListener('change', function(e) {
        currentSeason = parseInt(e.target.value, 10);
        renderEpisodesGrid();
      });

      document.getElementById('showsModalClose').onclick = function() {
        modal.style.display = 'none';
        document.body.classList.remove('no-scroll');
      };

      modal.addEventListener('click', function(e) {
        if (!e.target.closest('.modal-inner')) {
          modal.style.display = 'none';
          document.body.classList.remove('no-scroll');
        }
      }, { once: true });
    }

    function populateSeasonDropdown(show) {
      seasonDropdown.innerHTML = '';
      show.seasons.forEach(function(season) {
        const option = document.createElement('option');
        option.value = season.season;
        option.textContent = 'Season ' + season.season;
        seasonDropdown.appendChild(option);
      });
      seasonDropdown.value = currentSeason;
    }

    function renderEpisodesGrid() {
      const grid = document.getElementById('episodesGrid');
      grid.innerHTML = '';

      const show = shows[currentShowIndex];
      if (!show || !show.seasons) return;

      const selectedSeason = show.seasons.find(s => s.season === currentSeason);
      if (!selectedSeason) return;

      const filteredEpisodes = selectedSeason.episodes.filter(ep =>
        (ep.title || '').toLowerCase().includes(episodeQuery.toLowerCase())
      );

      filteredEpisodes.forEach(function(ep) {
        const card = document.createElement('div');
        card.className = 'card';

        const thumb = document.createElement('div');
        thumb.className = 'thumb';
        if (ep.coverUrl) {
          const img = document.createElement('img');
          img.src = ep.coverUrl;
          thumb.appendChild(img);
        } else {
          thumb.textContent = 'E' + ep.number + ': ' + ep.title;
        }

        thumb.addEventListener('click', function() {
          openViewer(ep.title, ep.url, 'show');
          document.getElementById('showsModal').style.display = 'none';
          document.body.classList.remove('no-scroll');
        });

        const info = document.createElement('div');
        info.className = 'info';

        const titleDiv = document.createElement('div');
        titleDiv.className = 'title';
        titleDiv.textContent = 'E' + ep.number + ': ' + ep.title;

        info.appendChild(titleDiv);

        card.appendChild(thumb);
        card.appendChild(info);
        grid.appendChild(card);
      });
    }

    function clearEpisodeSearch() {
      episodeQuery = '';
      if (episodeSearchInput) episodeSearchInput.value = '';
      renderEpisodesGrid();
    }

    function resetShows() {
      if (!confirm('Reset shows to default?')) return;
      shows = defaultShows.slice();
      saveJson(LS_KEYS.shows, shows);
      renderShows();
    }



    function renderProxies() {
      const list = document.getElementById('proxiesList');
      list.innerHTML = '';

      proxies.forEach(function(p) {
        const item = document.createElement('div');
        item.className = 'list-item';

        const left = document.createElement('div');
        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = p.title;

        const muted = document.createElement('div');
        muted.className = 'muted';
        muted.textContent = p.description || '';

        left.appendChild(title);
        left.appendChild(muted);

        const openBtn = document.createElement('button');
        openBtn.textContent = 'Open';
        openBtn.className = 'btn btn-primary';
        openBtn.addEventListener('click', function() {
          openInAboutBlank(p.url);
        });

        item.appendChild(left);
        item.appendChild(openBtn);
        list.appendChild(item);
      });
    }

    function openInAboutBlank(url) {
      const newTab = window.open('about:blank', '_blank');
      if (!newTab) return;
      newTab.document.write(
        '<html>' +
          '<head><title>Proxy</title></head>' +
          '<body style="margin:0;padding:0;overflow:hidden;">' +
            '<iframe src="' + url + '" style="width:100%;height:100vh;border:none;"></iframe>' +
          '</body>' +
        '</html>'
      );
      newTab.document.close();
    }


    function openViewer(title, src, type) {
      if (viewerOpen) return;
      viewerOpen = true;

      document.body.classList.add('no-scroll');
      document.getElementById('overlay').classList.add('open');
      document.getElementById('viewerTitle').textContent = title || 'Viewer';

      const iframe = document.getElementById('viewerIframe');
      iframe.src = 'about:blank';

      let allowAttr = 'autoplay; fullscreen; encrypted-media; picture-in-picture';
      if (type === 'game') {
        allowAttr += '; pointer-lock';
      }
      iframe.setAttribute('allow', allowAttr);

      if ((type === 'movie' || type === 'show') && src && src.indexOf('drive.google.com') !== -1) {
        let fileIdMatch = src.match(/\/d\/([a-zA-Z0-9_-]+)/);
        let fileId = fileIdMatch ? fileIdMatch[1] : null;
        if (fileId) {
          iframe.src = 'https://drive.google.com/file/d/' + fileId + '/preview?usp=sharing';
        } else {
          iframe.src = src.replace('/view', '/preview') + '?usp=sharing';
        }
        iframe.setAttribute(
          'sandbox',
          'allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-downloads'
        );
        iframe.setAttribute('referrerpolicy', 'no-referrer');
      } else {
        iframe.src = src || 'about:blank';
        iframe.onload = function() {
          try { iframe.contentWindow.focus(); } catch (e) {}
        };
      }
    }

    function closeViewer() {
      viewerOpen = false;
      document.getElementById('overlay').classList.remove('open');
      document.getElementById('viewerIframe').src = 'about:blank';
      document.body.classList.remove('no-scroll');

      const viewer = document.getElementById('viewer');
      viewer.classList.remove('fs');
      if (document.fullscreenElement) {
        document.exitFullscreen().catch(function(){});
      }
    }

    function initOverlayControls() {
      document.getElementById('closeOverlayBtn').addEventListener('click', closeViewer);

      document.getElementById('fullscreenBtn').addEventListener('click', function() {
        const viewer = document.getElementById('viewer');
        if (document.fullscreenElement) {
          document.exitFullscreen();
        } else {
          if (viewer.requestFullscreen) {
            viewer.requestFullscreen()
              .then(function() { viewer.classList.add('fs'); })
              .catch(function() { viewer.classList.add('fs'); });
          } else {
            viewer.classList.add('fs');
          }
        }
      });

      document.addEventListener('fullscreenchange', function() {
        const viewer = document.getElementById('viewer');
        if (document.fullscreenElement === viewer) {
          viewer.classList.add('fs');
        } else {
          viewer.classList.remove('fs');
        }
      });
    }



    function bindSettingsForm() {
      document.getElementById('bgColorPicker').value = rgbToHex(theme.bgColor || defaultTheme.bgColor);
      document.getElementById('bgImageUrl').value = theme.bgImage || '';
      document.getElementById('overallThemeColor').value = rgbToHex(theme.overallThemeColor || theme.accentColor || defaultTheme.accentColor);
      document.getElementById('accentColorPicker').value = rgbToHex(theme.accentColor || defaultTheme.accentColor);
      document.getElementById('buttonColorPicker').value = rgbToHex(theme.buttonColor || defaultTheme.buttonColor);
      document.getElementById('textColorPicker').value = rgbToHex(theme.textColor || defaultTheme.textColor);
      document.getElementById('effectColorPicker').value = rgbToHex(extractRGB(theme.effectColor) || '#CBA6F7');

      document.getElementById('presetThemeSelect').value = '';

      document.getElementById('tabTitleInput').value = cloak.title || '';
      document.getElementById('tabIconInput').value = cloak.icon || '';

      document.getElementById('viewerWidthInput').value =
        localStorage.getItem(LS_KEYS.viewerWidth) || '98';
      document.getElementById('viewerHeightInput').value =
        localStorage.getItem(LS_KEYS.viewerHeight) || '98';
      document.getElementById('panicKeyInput').value =
        localStorage.getItem(LS_KEYS.panicKey) || 'Escape';
      document.getElementById('panicUrlInput').value =
        localStorage.getItem(LS_KEYS.panicUrl) || 'https://www.google.com';
      document.getElementById('fontSizeInput').value =
        localStorage.getItem(LS_KEYS.fontSize) || '16';
      document.getElementById('performanceModeSelect').value =
        localStorage.getItem(LS_KEYS.performanceMode) || '0';
      document.getElementById('preserveBgToggle').checked = preserveBgOnTheme;
    }

    function saveSettings() {
      theme.bgColor = document.getElementById('bgColorPicker').value;
      theme.bgImage = document.getElementById('bgImageUrl').value.trim();
      theme.overallThemeColor = document.getElementById('overallThemeColor').value;
      theme.accentColor = document.getElementById('accentColorPicker').value;
      theme.buttonColor = document.getElementById('buttonColorPicker').value;
      theme.textColor = document.getElementById('textColorPicker').value;
      theme.effectColor = hexToRgba(document.getElementById('effectColorPicker').value, 0.3);

      saveJson(LS_KEYS.theme, theme);
      applyTheme(theme, currentThemeName);

      cloak.title = document.getElementById('tabTitleInput').value.trim() || document.title;
      cloak.icon = document.getElementById('tabIconInput').value.trim();
      saveJson(LS_KEYS.tabCloak, cloak);
      applyTabCloak();

      localStorage.setItem(LS_KEYS.viewerWidth, document.getElementById('viewerWidthInput').value);
      localStorage.setItem(LS_KEYS.viewerHeight, document.getElementById('viewerHeightInput').value);
      localStorage.setItem(LS_KEYS.panicKey, document.getElementById('panicKeyInput').value);
      localStorage.setItem(LS_KEYS.panicUrl, document.getElementById('panicUrlInput').value);
      localStorage.setItem(LS_KEYS.fontSize, document.getElementById('fontSizeInput').value);
      localStorage.setItem(LS_KEYS.performanceMode, document.getElementById('performanceModeSelect').value);

      preserveBgOnTheme = document.getElementById('preserveBgToggle').checked;
      localStorage.setItem(LS_KEYS.preserveBgOnTheme, preserveBgOnTheme);

      applyCustomSettings();
      applyTheme();
    }

    function resetSettings() {
      if (!confirm('Reset settings to default theme?')) return;
      theme = JSON.parse(JSON.stringify(defaultTheme));
      saveJson(LS_KEYS.theme, theme);
      localStorage.removeItem(LS_KEYS.currentTheme);
      currentThemeName = 'dashboard';
      applyTheme(theme, currentThemeName);
      bindSettingsForm();
    }

    function applyTabCloak() {
      if (cloak.title) document.title = cloak.title;

      let link = document.getElementById('dynamic-favicon');
      if (!link) {
        link = document.createElement('link');
        link.rel = 'icon';
        link.id = 'dynamic-favicon';
        document.head.appendChild(link);
      }

      if (cloak.icon && cloak.icon.length > 3) {
        link.href = cloak.icon;
      } else {
        link.removeAttribute('href');
      }
    }

    function bindNav() {
      document.querySelectorAll('.nav button').forEach(function(btn) {
        btn.addEventListener('click', function() {
          showPage(btn.dataset.target);
        });
      });
    }

    function bindHomeActions() {
      const goMovies = document.getElementById('homeMoviesBtn');
      const goGames = document.getElementById('homeGamesBtn');
      const surpriseMovieBtn = document.getElementById('surpriseMovieBtn');
      const surpriseGameBtn = document.getElementById('surpriseGameBtn');
      const movieShuffleBtn = document.getElementById('movieSurpriseBtn');
      const gameShuffleBtn = document.getElementById('gameSurpriseBtn');

      if (goMovies) goMovies.addEventListener('click', () => showPage('movies'));
      if (goGames) goGames.addEventListener('click', () => showPage('games'));
      if (surpriseMovieBtn) surpriseMovieBtn.addEventListener('click', surpriseMovie);
      if (surpriseGameBtn) surpriseGameBtn.addEventListener('click', surpriseGame);
      if (movieShuffleBtn) movieShuffleBtn.addEventListener('click', surpriseMovie);
      if (gameShuffleBtn) gameShuffleBtn.addEventListener('click', surpriseGame);

      document.querySelectorAll('.home-panel [data-target]').forEach(btn => {
        btn.addEventListener('click', () => showPage(btn.dataset.target));
      });
    }

    function bindMediaFilters() {
      const moviePills = document.querySelectorAll('#movieFilters .pill');
      moviePills.forEach(pill => {
        pill.addEventListener('click', () => {
          movieFilter = pill.dataset.filter;
          moviePills.forEach(p => p.classList.toggle('active', p === pill));
          renderMovies();
        });
      });

      const gamePills = document.querySelectorAll('#gameFilters .pill');
      gamePills.forEach(pill => {
        pill.addEventListener('click', () => {
          gameFilter = pill.dataset.filter;
          gamePills.forEach(p => p.classList.toggle('active', p === pill));
          infiniteGamesIndex = 0;
          renderGames(true);
        });
      });
    }

    function applyCustomSettings() {
      const root = document.documentElement;
      root.style.setProperty('--viewer-width', (localStorage.getItem(LS_KEYS.viewerWidth) || '98') + 'vw');
      root.style.setProperty('--viewer-height', (localStorage.getItem(LS_KEYS.viewerHeight) || '98') + 'vh');
      root.style.setProperty('--font-size-base', (localStorage.getItem(LS_KEYS.fontSize) || '16') + 'px');
      document.body.classList.toggle('performance-mode', localStorage.getItem(LS_KEYS.performanceMode) === '1');
    }

    document.addEventListener('keydown', function(e) {
      if (document.getElementById('overlay').classList.contains('open')) return;
      const panicKey = localStorage.getItem(LS_KEYS.panicKey) || 'Escape';
      const panicUrl = localStorage.getItem(LS_KEYS.panicUrl) || 'https://www.google.com';
      if (e.key === panicKey) {
        window.open(panicUrl, '_blank');
        window.location.href = panicUrl;
      }
    });



    function toggleBookmark(type, idx, title) {
      const existingIndex = bookmarks.findIndex(b => b.type === type && b.idx === idx);
      if (existingIndex !== -1) {
        bookmarks.splice(existingIndex, 1);
      } else {
        bookmarks.push({ type, idx, title });
      }
      saveJson(LS_KEYS.bookmarks, bookmarks);
      updateHomeStats();
    }

    function renderBookmarks() {
      const grid = document.getElementById('bookmarkGrid');
      grid.innerHTML = '';

      bookmarks.forEach(function(b, bookmarkIdx) {
        let iconUrl = '';
        if (b.type === 'movie') {
          const m = movies[b.idx];
          if (m && m.coverUrl) iconUrl = m.coverUrl;
        } else if (b.type === 'game') {
          const g = games[b.idx];
          if (g && (g.iconUrl || g.coverUrl || g.thumbnail || g.img || g.image)) {
            iconUrl = g.iconUrl || g.coverUrl || g.thumbnail || g.img || g.image;
          }
        } else if (b.type === 'show') {
          const s = shows[b.idx];
          if (s && s.coverUrl) iconUrl = s.coverUrl;
        }

        const item = document.createElement('div');
        item.className = 'bookmark-item';

        if (iconUrl) {
          const img = document.createElement('img');
          img.src = iconUrl;
          img.alt = b.title;
          item.appendChild(img);
        }

        const titleSpan = document.createElement('span');
        titleSpan.textContent = b.title;
        item.appendChild(titleSpan);

        item.addEventListener('click', function() {
          launchBookmark(b);
        });

        const removeBtn = document.createElement('span');
        removeBtn.className = 'remove-btn';
        removeBtn.innerHTML = '';
        removeBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          bookmarks.splice(bookmarkIdx, 1);
          saveJson(LS_KEYS.bookmarks, bookmarks);
          renderBookmarks();
        });

        item.appendChild(removeBtn);
        grid.appendChild(item);
      });
    }

    function launchBookmark(b) {
      if (b.type === 'movie') {
        const m = movies[b.idx];
        if (m) openViewer(m.title, m.driveLink, 'movie');
      } else if (b.type === 'game') {
        const g = games[b.idx];
        if (g) openViewer(g.title, g.src, 'game');
      } else if (b.type === 'show') {
        openShowsModal(b.idx);
      }
    }



    let quickQuery = '';

    function performQuickSearch() {
      quickQuery = document.getElementById('quickSearch').value.trim().toLowerCase();
      const resultsGrid = document.getElementById('searchResults');
      resultsGrid.innerHTML = '';

      if (quickQuery === '') {
        resultsGrid.style.display = 'none';
        return;
      }

      resultsGrid.style.display = 'grid';

      const movieResults = movies
        .filter(m => (m.title || '').toLowerCase().includes(quickQuery))
        .map(m => ({ ...m, type: 'movie', idx: movies.indexOf(m) }));

      const gameResults = games
        .filter(g => (g.title || '').toLowerCase().includes(quickQuery))
        .map(g => ({ ...g, type: 'game', idx: games.indexOf(g) }));

      const showResults = shows
        .filter(s => (s.title || '').toLowerCase().includes(quickQuery))
        .map(s => ({ ...s, type: 'show', idx: shows.indexOf(s) }));

      const combinedResults = [...movieResults, ...gameResults, ...showResults];

      combinedResults.sort((a, b) => {
        const aBookmarked = isBookmarked(a.type, a.idx) ? 1 : 0;
        const bBookmarked = isBookmarked(b.type, b.idx) ? 1 : 0;
        return bBookmarked - aBookmarked;
      });

      combinedResults.forEach(function(item) {
        const card = document.createElement('div');
        card.className = 'card';

        const thumb = document.createElement('div');
        thumb.className = 'thumb';

        const thumbUrl =
          item.coverUrl ||
          item.iconUrl ||
          item.thumbnail ||
          item.img ||
          item.image ||
          '';

        if (thumbUrl) {
          const img = document.createElement('img');
          img.src = thumbUrl;
          thumb.appendChild(img);
        } else {
          thumb.textContent = item.title;
        }

        thumb.addEventListener('click', function() {
          if (item.type === 'movie') {
            openViewer(item.title, item.driveLink, 'movie');
          } else if (item.type === 'game') {
            openViewer(item.title, item.src, 'game');
          } else if (item.type === 'show') {
            openShowsModal(item.idx);
          }
        });

        const info = document.createElement('div');
        info.className = 'info';

        const left = document.createElement('div');
        const titleDiv = document.createElement('div');
        titleDiv.className = 'title';
        titleDiv.textContent = item.title + ' (' + item.type + ')';

        const sub = document.createElement('div');
        sub.className = 'small muted';
        sub.textContent = 'Click to open';

        left.appendChild(titleDiv);
        left.appendChild(sub);

        if (item.tags) {
          const tagsDiv = document.createElement('div');
          tagsDiv.className = 'tags';
          item.tags.forEach(tag => {
            const tagSpan = document.createElement('span');
            tagSpan.className = 'tag';
            tagSpan.textContent = tag;
            tagsDiv.appendChild(tagSpan);
          });
          left.appendChild(tagsDiv);
        }

        const bookmarkStar = document.createElement('span');
        bookmarkStar.className = 'bookmark-star';
        bookmarkStar.innerHTML = '';
        bookmarkStar.classList.toggle('active', isBookmarked(item.type, item.idx));
        bookmarkStar.addEventListener('click', function(e) {
          e.stopPropagation();
          toggleBookmark(item.type, item.idx, item.title);
          bookmarkStar.classList.toggle('active');
          renderBookmarks();
          performQuickSearch();
        });

        info.appendChild(left);
        info.appendChild(bookmarkStar);

        card.appendChild(thumb);
        card.appendChild(info);
        resultsGrid.appendChild(card);
      });
    }

    /* -------------------- CLOCK -------------------- */

    function updateClock() {
      const clockEl = document.getElementById('clock');
      if (!clockEl) return;
      const now = new Date();
      const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
      clockEl.textContent = time;
    }

    setInterval(updateClock, 1000);



    function init() {
      applyTheme(theme, currentThemeName);
      applyTabCloak();
      renderProfile();
      renderBookmarks();
      updateHomeStats();
      initProfileDropdown();
      bindNav();
      bindHomeActions();
      bindMediaFilters();
      renderMovies();
      renderGames(true);
      renderShows();
      renderProxies();
      bindSettingsForm();
      initOverlayControls();
      applyCustomSettings();
      updateClock();
      setupGameInfiniteScroll();

      document.getElementById('closeLogBtn').addEventListener('click', function() {
        document.getElementById('updateLog').style.display = 'none';
      });
      document.getElementById('updateLog').style.display = 'flex';

      const presetSelect = document.getElementById('presetThemeSelect');
      if (presetSelect) {
        presetSelect.addEventListener('change', function(e) {
          const name = e.target.value;
          if (!name) return;
          presetTheme(name);
          e.target.value = '';
        });
      }

      document.getElementById('applyTabCloakBtn').addEventListener('click', function() {
        cloak.title = document.getElementById('tabTitleInput').value.trim() || cloak.title;
        cloak.icon = document.getElementById('tabIconInput').value.trim();
        saveJson(LS_KEYS.tabCloak, cloak);
        applyTabCloak();
      });

      document.getElementById('cloakGoogleBtn').addEventListener('click', function() {
        cloak = { title: 'Google', icon: 'https://www.google.com/favicon.ico' };
        saveJson(LS_KEYS.tabCloak, cloak);
        bindSettingsForm();
        applyTabCloak();
      });

      document.getElementById('cloakCanvasBtn').addEventListener('click', function() {
        cloak = { title: 'Dashboard', icon: 'https://ccisd.instructure.com/favicon.ico' };
        saveJson(LS_KEYS.tabCloak, cloak);
        bindSettingsForm();
        applyTabCloak();
      });

      document.getElementById('resetCloakBtn').addEventListener('click', function() {
        cloak = { title: 'Media Hub', icon: '' };
        saveJson(LS_KEYS.tabCloak, cloak);
        bindSettingsForm();
        applyTabCloak();
      });

      const wallpaperSelect = document.getElementById('defaultWallpaperSelect');
      if (wallpaperSelect) {
        wallpaperSelect.addEventListener('change', function(e) {
          const url = e.target.value;
          if (url) {
            document.getElementById('bgImageUrl').value = url;
            theme.bgImage = url;
            applyTheme();
          }
          e.target.value = '';
        });
      }

      document.getElementById('quickSearch').addEventListener('input', performQuickSearch);
      document.getElementById('quickSearchBtn').addEventListener('click', performQuickSearch);
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
